<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muay Thai Complete Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .screen {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
            animation: slideIn 0.3s ease;
        }

        .screen#main-menu {
            background: transparent;
            box-shadow: none;
        }

        .screen.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .main-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .menu-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .menu-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .menu-item .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .menu-item h3 {
            font-size: 1.6rem;
            margin-bottom: 15px;
        }

        .menu-item p {
            opacity: 0.9;
            line-height: 1.5;
        }

        .technique-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .technique-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .technique-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        .technique-item h3 {
            font-size: 1.4rem;
            margin-bottom: 10px;
        }

        .technique-item p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .back-button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        .category-header {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 30px 0 20px 0;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .content-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .content-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .content-card h4 {
            color: #2d3436;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .content-card p {
            line-height: 1.6;
            color: #636e72;
        }

        .fight-card {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fight-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .fight-card h4 {
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .fight-card .fighters {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .fight-card .details {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .technique-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .technique-title {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 10px;
        }

        .thai-pronunciation {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .thai-pronunciation h4 {
            color: #2d3436;
            margin-bottom: 5px;
        }

        .thai-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: #636e72;
        }

        .technique-image {
            width: 100%;
            max-width: 400px;
            height: 300px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border-radius: 10px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            text-align: center;
        }

        .description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            line-height: 1.6;
        }

        .video-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .video-container {
            background: #2d3436;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .video-container h4 {
            color: white;
            margin-bottom: 15px;
        }

        .video-placeholder {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #636e72, #2d3436);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-placeholder:hover {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .play-button {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .game-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .game-area {
            grid-column: 1 / -1;
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }

        .game-rules {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 25px;
            border-radius: 15px;
        }

        .game-rules h3 {
            margin-bottom: 20px;
            text-align: center;
        }

        .rules-grid {
            display: grid;
            gap: 10px;
        }

        .rule-item {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .scoreboard {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            padding: 25px;
            border-radius: 15px;
        }

        .scoreboard h3 {
            margin-bottom: 20px;
            text-align: center;
        }

        .main-score {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .score-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .score-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .score-divider {
            font-size: 2rem;
            font-weight: bold;
        }

        .weapon-stats h4 {
            text-align: center;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .weapon-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .weapon-stat {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
        }

        .battle-display {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .fighter-choice {
            text-align: center;
        }

        .fighter-choice h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .choice-display {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            margin: 0 auto;
        }

        .vs-text {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }

        .result-display {
            margin-bottom: 30px;
            font-size: 1.5rem;
            font-weight: bold;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-display.win {
            color: #00b894;
        }

        .result-display.lose {
            color: #e17055;
        }

        .result-display.tie {
            color: #fdcb6e;
        }

        .weapon-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .weapon-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .weapon-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        .weapon-btn:active {
            transform: translateY(-2px);
        }

        .weapon-icon {
            font-size: 3rem;
        }

        .weapon-name {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .reset-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .reset-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        /* Battle System Styles */
        .fighter-selection-screen {
            display: block;
        }

        .fighter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .fighter-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .fighter-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .fighter-avatar {
            font-size: 4rem;
            margin-bottom: 15px;
            display: block;
        }

        .fighter-card h4 {
            font-size: 1.4rem;
            margin-bottom: 8px;
        }

        .fighter-card p {
            opacity: 0.9;
            margin-bottom: 10px;
            font-style: italic;
        }

        .fighter-stats {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
        }

        .battle-screen {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
        }

        .round-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .round-counter {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .turn-indicator {
            font-size: 1.1rem;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
        }

        .stat-circles {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .stat-circle {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .stat-circle-value {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: bold;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .stat-circle-label {
            font-size: 0.75rem;
            color: #666;
            font-weight: 500;
            text-align: center;
        }

        .clinch-status-circle {
            transition: all 0.3s ease;
        }

        .clinch-status-circle.distance {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .clinch-status-circle.clinching {
            background: linear-gradient(135deg, #00b894, #00cec9);
        }

        .clinch-status-circle.clinched {
            background: linear-gradient(135deg, #e17055, #d63031);
        }

        .battle-arena {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .fighter-display {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: center;
            margin-bottom: 25px;
        }

        .fighter-info {
            text-align: center;
        }

        .fighter-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        .fighter-avatar-large {
            font-size: 5rem;
            margin-bottom: 20px;
            display: block;
        }

        .health-bar {
            max-width: 200px;
            margin: 0 auto;
        }

        .health-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
        }

        .health-bar-container {
            background: #e0e0e0;
            border-radius: 20px;
            height: 20px;
            position: relative;
            overflow: hidden;
        }

        .health-bar-fill {
            background: linear-gradient(90deg, #00b894, #55a3ff);
            height: 100%;
            border-radius: 20px;
            transition: width 0.5s ease;
            position: relative;
        }

        .health-bar-fill.low {
            background: linear-gradient(90deg, #e17055, #fd79a8);
        }

        .health-bar-fill.critical {
            background: linear-gradient(90deg, #d63031, #e17055);
        }

        .health-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }

        .vs-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .action-display {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .action-text {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2d3436;
        }

        /* Clinch Status Display Styles */
        .clinch-status-display {
            background: linear-gradient(135deg, #e17055, #d63031);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: clinchPulse 2s ease-in-out infinite alternate;
        }

        @keyframes clinchPulse {
            from { box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
            to { box-shadow: 0 15px 40px rgba(225,112,85,0.4); }
        }

        .clinch-indicator {
            color: white;
        }

        .clinch-fighters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .clinch-fighter {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .clinch-fighter.controlling {
            transform: scale(1.1);
        }

        .clinch-fighter.controlled {
            opacity: 0.7;
            transform: scale(0.9);
        }

        .clinch-avatar {
            font-size: 3rem;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid rgba(255,255,255,0.4);
            transition: all 0.3s ease;
        }

        .clinch-fighter.controlling .clinch-avatar {
            border-color: #fdcb6e;
            background: rgba(253,203,110,0.3);
            box-shadow: 0 0 20px rgba(253,203,110,0.5);
        }

        .clinch-name {
            font-size: 1.1rem;
            font-weight: bold;
            text-align: center;
        }

        .clinch-control-indicator {
            font-size: 1.5rem;
            opacity: 0.3;
            transition: all 0.3s ease;
        }

        .clinch-fighter.controlling .clinch-control-indicator {
            opacity: 1;
            animation: controlPulse 1s ease-in-out infinite alternate;
        }

        @keyframes controlPulse {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }

        .clinch-connector {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .clinch-lock-icon {
            font-size: 2.5rem;
            animation: lockShake 1.5s ease-in-out infinite;
        }

        @keyframes lockShake {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        .clinch-status-text {
            font-size: 1.2rem;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .clinch-control-text {
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .clinch-control-text.player-control {
            background: rgba(253,203,110,0.3);
            border-color: #fdcb6e;
            color: #fdcb6e;
        }

        .clinch-control-text.opponent-control {
            background: rgba(255,107,107,0.3);
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .attack-history-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .player-attack-history, .opponent-attack-history {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .attack-history-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }

        .attack-history-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-attack-history .attack-history-content {
            justify-content: flex-start;
        }

        .opponent-attack-history .attack-history-content {
            justify-content: flex-end;
        }

        .attack-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .attack-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .player-attack-history .attack-details {
            text-align: left;
        }

        .opponent-attack-history .attack-details {
            text-align: right;
        }

        .attack-name {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .attack-power {
            font-size: 0.9rem;
            opacity: 0.9;
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .vs-connector {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .connector-line {
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
            margin-bottom: 8px;
            position: relative;
        }

        .connector-line::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-right: 8px solid #667eea;
        }

        .connector-line::after {
            content: '';
            position: absolute;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 8px solid #764ba2;
        }

        .vs-circle {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
            border: 3px solid white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .attack-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .attack-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 20px 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .attack-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .attack-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Tactical Menu Styles */
        .tactical-menu {
            margin-bottom: 25px;
        }

        .menu-categories {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .category-btn {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            border: none;
            padding: 25px 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .category-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        .category-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .attack-category {
            background: linear-gradient(135deg, #e17055, #d63031);
        }

        .defense-category {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .clinch-category {
            background: linear-gradient(135deg, #fd79a8, #e84393);
        }

        .category-icon {
            font-size: 2.5rem;
        }

        .category-name {
            font-size: 1.3rem;
        }

        .back-to-menu-btn {
            background: linear-gradient(135deg, #2d3436, #636e72);
        }

        .back-to-menu-btn:hover {
            background: linear-gradient(135deg, #636e72, #2d3436);
        }

        .defense-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .slip-btn {
            background: linear-gradient(135deg, #00cec9, #00b894);
        }

        .roll-btn {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }

        .evade-btn {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
        }

        .check-btn {
            background: linear-gradient(135deg, #fd79a8, #e84393);
        }

        .parry-btn {
            background: linear-gradient(135deg, #55a3ff, #3742fa);
        }

        .knee-shield-btn {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
        }

        .block-btn {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .teep-btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
        }

        .clinch-btn {
            background: linear-gradient(135deg, #fd79a8, #e84393);
        }

        .full-plum-btn {
            background: linear-gradient(135deg, #d63031, #e17055);
        }

        .inside-bicep-btn {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
        }

        .outside-bicep-btn {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }

        .escape-btn {
            background: linear-gradient(135deg, #00b894, #55a3ff);
        }

        .sweep-btn {
            background: linear-gradient(135deg, #e17055, #d63031);
        }

        .attack-icon {
            font-size: 2rem;
        }

        .attack-name {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .attack-damage {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .control-btn {
            background: #636e72;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #2d3436;
            transform: translateY(-2px);
        }

        .corner-break-screen {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }

        .corner-break-header h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .rest-timer {
            font-size: 1.3rem;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin-bottom: 25px;
        }

        .corner-instructions {
            margin-bottom: 25px;
            font-size: 1.1rem;
        }

        .corner-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .corner-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 20px 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .corner-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-3px);
        }

        .corner-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .corner-icon {
            font-size: 2rem;
        }

        .corner-name {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .corner-effect {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .corner-status {
            font-size: 1.2rem;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
        }

        .timer-display {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
        }

        /* Large Timer Popup */
        .timer-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #d63031, #e17055);
            color: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            z-index: 1000;
            text-align: center;
            border: 4px solid rgba(255,255,255,0.3);
            animation: timerPulse 1s ease-in-out infinite alternate;
        }

        /* Rules Popup Modal */
        .rules-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .rules-popup-container {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            border-radius: 20px;
            max-width: 800px;
            max-height: 80vh;
            margin: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            border: 4px solid rgba(255,255,255,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .rules-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: rgba(255,255,255,0.1);
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .rules-popup-header h3 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .rules-close-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rules-close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .rules-popup-content {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .rules-popup-content .rules-list {
            font-size: 0.95rem;
            line-height: 1.6;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .rules-popup-content .rules-list li {
            margin-bottom: 12px;
            padding: 10px 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            border-left: 4px solid rgba(255,255,255,0.3);
        }

        @keyframes timerPulse {
            from { transform: translate(-50%, -50%) scale(1); }
            to { transform: translate(-50%, -50%) scale(1.05); }
        }

        .timer-popup h3 {
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .timer-clock {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            font-family: 'Courier New', monospace;
        }

        .timer-message {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        /* Mid-Round Healing Options */
        .healing-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .healing-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.4);
            padding: 15px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .healing-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.6);
            transform: translateY(-3px);
        }

        .healing-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .healing-icon {
            font-size: 1.8rem;
        }

        .healing-name {
            font-weight: bold;
        }

        .healing-effect {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* Game Main Menu Styles */
        .game-main-menu {
            display: block;
        }

        .game-menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .game-menu-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .game-menu-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .game-menu-item .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
        }

        .game-menu-item h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .game-menu-item p {
            opacity: 0.9;
            line-height: 1.5;
            font-size: 1.1rem;
        }

        /* Career Mode Styles */
        .career-setup-screen {
            background: white;
            border-radius: 15px;
            padding: 30px;
        }

        .career-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-group label {
            display: block;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .avatar-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
        }

        .avatar-option {
            width: 80px;
            height: 80px;
            border: 3px solid #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .avatar-option:hover {
            border-color: #667eea;
            transform: scale(1.1);
        }

        .avatar-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.1);
        }

        .specialty-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .specialty-option {
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .specialty-option:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .specialty-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .specialty-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .specialty-desc {
            font-size: 0.95rem;
            opacity: 0.8;
        }

        .career-buttons {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 40px;
        }

        .career-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .back-career-btn {
            background: #636e72;
            color: white;
        }

        .back-career-btn:hover {
            background: #2d3436;
            transform: translateY(-2px);
        }

        .create-fighter-btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            flex: 1;
        }

        .create-fighter-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .create-fighter-btn:disabled {
            background: #ddd;
            color: #999;
            cursor: not-allowed;
        }

        .reset-career-btn {
            background: #e17055;
            color: white;
        }

        .reset-career-btn:hover {
            background: #d63031;
            transform: translateY(-2px);
        }

        /* Career Main Screen */
        .career-main-screen {
            background: white;
            border-radius: 15px;
            padding: 30px;
        }

        .career-header {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .fighter-profile {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            border: 3px solid rgba(255,255,255,0.3);
        }

        .profile-info h3 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .record {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
        }

        .specialty-display {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .career-opponents {
            margin-bottom: 30px;
        }

        .opponent-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .opponent-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .opponent-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        .opponent-card.defeated {
            background: linear-gradient(135deg, #00b894, #00cec9);
        }

        .opponent-card.defeated::after {
            content: '✓';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .opponent-avatar {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .opponent-card h4 {
            font-size: 1.3rem;
            margin-bottom: 8px;
        }

        .opponent-card p {
            opacity: 0.9;
            margin-bottom: 10px;
            font-style: italic;
        }

        .opponent-stats {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
        }

        .career-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .combat-rules {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .rules-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
        }

        .rules-header:hover {
            opacity: 0.8;
        }

        .combat-rules h4 {
            margin: 0;
            font-size: 1.2rem;
        }

        .rules-toggle {
            font-size: 1.2rem;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .rules-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .rules-content {
            max-height: 500px;
            overflow-y: auto;
            overflow-x: hidden;
            transition: max-height 0.3s ease;
            margin-top: 15px;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) rgba(255,255,255,0.1);
        }

        .rules-content::-webkit-scrollbar {
            width: 8px;
        }

        .rules-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        .rules-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        .rules-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        .rules-content.collapsed {
            max-height: 0;
            margin-top: 0;
            overflow: hidden;
        }

        .rules-list {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .rules-list li {
            margin-bottom: 8px;
            opacity: 0.95;
        }

        .rules-section {
            margin-bottom: 15px;
        }

        .rules-subsection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .rules-subsection-header:hover {
            background: rgba(255,255,255,0.15);
        }

        .rules-subsection-title {
            font-weight: bold;
            font-size: 1rem;
        }

        .rules-subsection-toggle {
            font-size: 1rem;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .rules-subsection-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .rules-subsection-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding-left: 15px;
            border-left: 2px solid rgba(255,255,255,0.2);
            margin-left: 10px;
        }

        .rules-subsection-content.collapsed {
            max-height: 0;
            margin-bottom: 0;
        }

        .rules-sub-subsection {
            margin-top: 15px;
            margin-left: 10px;
        }

        .rules-sub-subsection .rules-subsection-header {
            background: rgba(255,255,255,0.05);
            font-size: 0.9rem;
        }

        .rules-sub-subsection .rules-subsection-content {
            padding-left: 10px;
            border-left: 1px solid rgba(255,255,255,0.15);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .main-menu {
                grid-template-columns: 1fr;
            }
            
            .technique-grid {
                grid-template-columns: 1fr;
            }
            
            .technique-title {
                font-size: 2rem;
            }

            .fighter-grid {
                grid-template-columns: 1fr;
            }

            .fighter-display {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .vs-display {
                order: 2;
                font-size: 2rem;
            }

            .attack-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .round-info {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .game-controls {
                flex-direction: column;
                align-items: center;
            }

            .attack-history-container {
                grid-template-columns: 1fr;
                gap: 15px;
                text-align: center;
            }

            .vs-connector {
                order: 2;
            }

            .opponent-attack-history {
                order: 3;
            }

            .opponent-attack-history .attack-history-content {
                justify-content: center;
            }

            .player-attack-history .attack-history-content {
                justify-content: center;
            }

            .opponent-attack-history .attack-details {
                text-align: center;
            }

            .player-attack-history .attack-details {
                text-align: center;
            }

            /* Clinch Display Mobile Styles */
            .clinch-fighters {
                flex-direction: column;
                gap: 15px;
            }

            .clinch-connector {
                order: 2;
            }

            .clinch-avatar {
                width: 60px;
                height: 60px;
                font-size: 2rem;
            }

            .clinch-control-text {
                font-size: 1.1rem;
                padding: 12px;
            }

            .clinch-status-display {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🥊 Muay Thai Complete Guide 🥊</h1>
            <p>Master the Art of Eight Limbs</p>
        </div>

        <!-- Main Menu Screen -->
        <div id="main-menu" class="screen active">
            <div class="main-menu">
                <div class="menu-item" onclick="showScreen('techniques')">
                    <span class="icon">🥊</span>
                    <h3>Muay Thai Techniques</h3>
                    <p>Complete breakdown of punches, kicks, elbows, knees, and clinch work with Thai names and video demonstrations</p>
                </div>
                
                <div class="menu-item" onclick="showScreen('fight-vault')">
                    <span class="icon">🏆</span>
                    <h3>Fight Vault</h3>
                    <p>Legendary fights, knockouts, and classic matches from Muay Thai history with analysis and highlights</p>
                </div>
                
                <div class="menu-item" onclick="showScreen('styles')">
                    <span class="icon">⚔️</span>
                    <h3>Fighting Styles</h3>
                    <p>Different approaches to Muay Thai from various camps and regions, including famous fighter styles</p>
                </div>
                
                <div class="menu-item" onclick="showScreen('history')">
                    <span class="icon">🏛️</span>
                    <h3>History & Culture</h3>
                    <p>Origins of Muay Thai, cultural significance, rituals, and evolution from ancient battlefield art to modern sport</p>
                </div>
                
                <div class="menu-item" onclick="showScreen('game')">
                    <span class="icon">🎮</span>
                    <h3>Muay Thai Game</h3>
                    <p>Play the ultimate martial arts game! Strategic combat with rock-paper-scissors mechanics and legendary fighters</p>
                </div>
            </div>
        </div>

        <!-- Techniques Screen -->
        <div id="techniques" class="screen">
            <button class="back-button" onclick="showScreen('main-menu')">← Back to Main Menu</button>
            
            <div class="category-header">Punches (หมัด - Mat)</div>
            <div class="technique-grid">
                <div class="technique-item" onclick="showTechnique('jab')">
                    <h3>Jab</h3>
                    <p>Quick straight punch with the lead hand</p>
                </div>
                <div class="technique-item" onclick="showTechnique('cross')">
                    <h3>Cross</h3>
                    <p>Powerful straight punch with the rear hand</p>
                </div>
                <div class="technique-item" onclick="showTechnique('hook')">
                    <h3>Hook</h3>
                    <p>Circular punch targeting the side of the opponent</p>
                </div>
                <div class="technique-item" onclick="showTechnique('uppercut')">
                    <h3>Uppercut</h3>
                    <p>Upward punch targeting the chin or body</p>
                </div>
            </div>

            <div class="category-header">Kicks (เตะ - Tae)</div>
            <div class="technique-grid">
                <div class="technique-item" onclick="showTechnique('roundhouse')">
                    <h3>Roundhouse Kick</h3>
                    <p>Powerful circular kick using the shin</p>
                </div>
                <div class="technique-item" onclick="showTechnique('teep')">
                    <h3>Teep (Push Kick)</h3>
                    <p>Front kick used to push opponent away</p>
                </div>
                <div class="technique-item" onclick="showTechnique('lowkick')">
                    <h3>Low Kick</h3>
                    <p>Kick targeting the opponent's legs</p>
                </div>
            </div>

            <div class="category-header">Elbows (ศอก - Sok)</div>
            <div class="technique-grid">
                <div class="technique-item" onclick="showTechnique('horizontal-elbow')">
                    <h3>Horizontal Elbow</h3>
                    <p>Side elbow strike across the body</p>
                </div>
                <div class="technique-item" onclick="showTechnique('upward-elbow')">
                    <h3>Upward Elbow</h3>
                    <p>Rising elbow targeting the chin</p>
                </div>
            </div>

            <div class="category-header">Knees (เข่า - Khao)</div>
            <div class="technique-grid">
                <div class="technique-item" onclick="showTechnique('straight-knee')">
                    <h3>Straight Knee</h3>
                    <p>Direct knee strike to the body or head</p>
                </div>
                <div class="technique-item" onclick="showTechnique('clinch-knee')">
                    <h3>Clinch Knee</h3>
                    <p>Knee strike from the clinch position</p>
                </div>
            </div>

            <div class="category-header">Clinch Work (จับ - Jab)</div>
            <div class="technique-grid">
                <div class="technique-item" onclick="showTechnique('plum-clinch')">
                    <h3>Plum Clinch</h3>
                    <p>Double collar tie controlling opponent's head</p>
                </div>
                <div class="technique-item" onclick="showTechnique('arm-drag')">
                    <h3>Arm Drag</h3>
                    <p>Pulling opponent off balance to create openings</p>
                </div>
                <div class="technique-item" onclick="showTechnique('clinch-sweep')">
                    <h3>Clinch Sweep</h3>
                    <p>Foot sweep to take opponent down from clinch</p>
                </div>
                <div class="technique-item" onclick="showTechnique('neck-wrestling')">
                    <h3>Neck Wrestling</h3>
                    <p>Controlling and manipulating opponent's posture</p>
                </div>
            </div>
        </div>

        <!-- Fight Vault Screen -->
        <div id="fight-vault" class="screen">
            <button class="back-button" onclick="showScreen('main-menu')">← Back to Main Menu</button>
            <h2 style="text-align: center; margin-bottom: 30px; color: #333;">🏆 Fight Vault</h2>
            
            <div class="category-header">Legendary Fights</div>
            <div class="fight-card" onclick="playFight('samart-dieselnoi')">
                <h4>🔥 Classic Encounter</h4>
                <div class="fighters">Samart Payakaroon vs Dieselnoi Chor Thanasukarn</div>
                <div class="details">Lumpinee Stadium • 1982 • Technical masterpiece vs devastating knees</div>
            </div>
            
            <div class="fight-card" onclick="playFight('ramon-saenchai')">
                <h4>⚡ Modern Classic</h4>
                <div class="fighters">Ramon Dekkers vs Saenchai</div>
                <div class="details">Multiple encounters • Dutch aggression meets Thai artistry</div>
            </div>

            <div class="category-header">Greatest Knockouts</div>
            <div class="content-grid">
                <div class="content-card">
                    <h4>🥊 Devastating Elbows</h4>
                    <p>Collection of the most brutal elbow knockouts in Muay Thai history, showcasing the devastating power of this close-range weapon.</p>
                </div>
                <div class="content-card">
                    <h4>🦵 Legendary Kicks</h4>
                    <p>Roundhouse kicks that ended fights instantly, demonstrating perfect technique and timing from Thailand's greatest fighters.</p>
                </div>
                <div class="content-card">
                    <h4>🔥 Flying Knees</h4>
                    <p>Spectacular jumping knee knockouts that showcase the athletic ability and precision of elite Muay Thai fighters.</p>
                </div>
            </div>

            <div class="category-header">Fighter Spotlights</div>
            <div class="content-grid">
                <div class="content-card">
                    <h4>👑 Samart Payakaroon</h4>
                    <p>The most technically gifted fighter in Muay Thai history. Known for his boxing skills, ring IQ, and ability to make the sport look effortless.</p>
                </div>
                <div class="content-card">
                    <h4>🦴 Dieselnoi Chor Thanasukarn</h4>
                    <p>The Sky Piercing Knee. Dominated the golden era with his devastating clinch work and unmatched knee strikes.</p>
                </div>
                <div class="content-card">
                    <h4>🎯 Saenchai</h4>
                    <p>Modern legend known for his creative techniques, showmanship, and ability to defeat much larger opponents with skill and timing.</p>
                </div>
            </div>
        </div>

        <!-- Styles Screen -->
        <div id="styles" class="screen">
            <button class="back-button" onclick="showScreen('main-menu')">← Back to Main Menu</button>
            <h2 style="text-align: center; margin-bottom: 30px; color: #333;">⚔️ Fighting Styles</h2>
            
            <div class="category-header">Regional Styles</div>
            <div class="content-grid">
                <div class="content-card">
                    <h4>🏛️ Bangkok Style</h4>
                    <p>Technical, boxing-heavy approach emphasizing clean technique, ring control, and point scoring. Favors precision over power with excellent defensive skills.</p>
                </div>
                <div class="content-card">
                    <h4>🌾 Northern Style</h4>
                    <p>Aggressive, forward-pressure fighting with emphasis on kicks and knees. Known for relentless pace and conditioning from rural training camps.</p>
                </div>
                <div class="content-card">
                    <h4>🏝️ Southern Style</h4>
                    <p>Brutal, no-nonsense approach focusing on elbows, clinch work, and devastating low kicks. Emphasizes toughness and finishing fights.</p>
                </div>
            </div>

            <div class="category-header">Famous Camp Styles</div>
            <div class="content-grid">
                <div class="content-card">
                    <h4>🔥 Jocky Gym</h4>
                    <p>Produces technical fighters with excellent boxing fundamentals. Known for developing well-rounded fighters who excel in all ranges.</p>
                </div>
                <div class="content-card">
                    <h4>⚡ Fairtex</h4>
                    <p>Modern training methods combined with traditional techniques. Emphasizes athleticism, conditioning, and international competition preparation.</p>
                </div>
                <div class="content-card">
                    <h4>🏆 Sityodtong</h4>
                    <p>Legendary camp known for producing champions. Focuses on mental toughness, technical precision, and the warrior spirit of Muay Thai.</p>
                </div>
            </div>

            <div class="category-header">Fighter Archetypes</div>
            <div class="content-grid">
                <div class="content-card">
                    <h4>🥊 The Boxer</h4>
                    <p>Emphasizes hand techniques, footwork, and ring generalship. Uses superior boxing skills to control distance and outpoint opponents.</p>
                </div>
                <div class="content-card">
                    <h4>🦵 The Kicker</h4>
                    <p>Specializes in devastating leg kicks and body kicks. Uses reach advantage and timing to damage opponents from the outside.</p>
                </div>
                <div class="content-card">
                    <h4>🤼 The Clinch Fighter</h4>
                    <p>Dominates in close quarters with superior clinch work, knees, and elbows. Excels at controlling opponents and finishing fights up close.</p>
                </div>
                <div class="content-card">
                    <h4>⚡ The Technician</h4>
                    <p>Master of timing, distance, and technique. Uses superior skill and ring IQ to outclass opponents with minimal wasted movement.</p>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game" class="screen">
            <button class="back-button" onclick="showScreen('main-menu')">← Back to Main Menu</button>
            <h2 style="text-align: center; margin-bottom: 30px; color: #333;">🎮 Muay Thai Battle Arena</h2>
            
            <!-- Game Main Menu -->
            <div id="game-main-menu" class="game-main-menu">
                <div class="game-menu-grid">
                    <div class="game-menu-item" onclick="showExhibitionFight()">
                        <span class="icon">⚡</span>
                        <h3>Exhibition Fight</h3>
                        <p>Quick fight - choose any fighter and battle!</p>
                    </div>
                    
                    <div class="game-menu-item" onclick="showCareerMode()">
                        <span class="icon">🏆</span>
                        <h3>Career Mode</h3>
                        <p>Create your fighter and climb the rankings!</p>
                    </div>
                </div>
            </div>

            <!-- Career Mode Setup -->
            <div id="career-setup" class="career-setup-screen" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 30px; color: #333;">Create Your Fighter</h3>
                
                <div class="career-form">
                    <div class="form-group">
                        <label for="fighter-name">Fighter Name:</label>
                        <input type="text" id="fighter-name" placeholder="Enter your fighter's name" maxlength="20">
                    </div>
                    
                    <div class="form-group">
                        <label>Choose Avatar:</label>
                        <div class="avatar-selection" id="avatar-selection">
                            <!-- Avatar options will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Choose Specialty:</label>
                        <div class="specialty-selection">
                            <div class="specialty-option" data-specialty="dieselnoi" onclick="selectSpecialty('dieselnoi')">
                                <div class="specialty-name">Knees</div>
                                <div class="specialty-desc">+3 damage with knee attacks</div>
                            </div>
                            <div class="specialty-option" data-specialty="buakaw" onclick="selectSpecialty('buakaw')">
                                <div class="specialty-name">Kicks</div>
                                <div class="specialty-desc">+3 damage with kicks & teeps</div>
                            </div>
                            <div class="specialty-option" data-specialty="samart" onclick="selectSpecialty('samart')">
                                <div class="specialty-name">Punches</div>
                                <div class="specialty-desc">+3 damage with punches</div>
                            </div>
                            <div class="specialty-option" data-specialty="namsaknoi" onclick="selectSpecialty('namsaknoi')">
                                <div class="specialty-name">Elbows</div>
                                <div class="specialty-desc">+3 damage with elbows</div>
                            </div>
                            <div class="specialty-option" data-specialty="saenchai" onclick="selectSpecialty('saenchai')">
                                <div class="specialty-name">All-Around</div>
                                <div class="specialty-desc">+1 damage to all attacks & heals</div>
                            </div>
                            <div class="specialty-option" data-specialty="sagat" onclick="selectSpecialty('sagat')">
                                <div class="specialty-name">Power</div>
                                <div class="specialty-desc">+10 damage when winning exchanges</div>
                            </div>
                            <div class="specialty-option" data-specialty="somrak" onclick="selectSpecialty('somrak')">
                                <div class="specialty-name">Speed</div>
                                <div class="specialty-desc">All opponent attacks -2 damage</div>
                            </div>
                            <div class="specialty-option" data-specialty="yodsanklai" onclick="selectSpecialty('yodsanklai')">
                                <div class="specialty-name">Technique</div>
                                <div class="specialty-desc">+8 damage when winning, -2 when losing</div>
                            </div>
                            <div class="specialty-option" data-specialty="johnwayne" onclick="selectSpecialty('johnwayne')">
                                <div class="specialty-name">Heart</div>
                                <div class="specialty-desc">+10 heal bonus, +25 if both heal</div>
                            </div>
                            <div class="specialty-option" data-specialty="petchboonchu" onclick="selectSpecialty('petchboonchu')">
                                <div class="specialty-name">Clinch</div>
                                <div class="specialty-desc">+5 damage to all clinch attacks</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="career-buttons">
                        <button class="career-btn back-career-btn" onclick="showGameMainMenu()">← Back</button>
                        <button class="career-btn create-fighter-btn" onclick="createCareerFighter()" id="create-fighter-btn" disabled>Create Fighter</button>
                    </div>
                </div>
            </div>

            <!-- Career Mode Main -->
            <div id="career-main" class="career-main-screen" style="display: none;">
                <div class="career-header">
                    <div class="fighter-profile">
                        <div class="profile-avatar" id="career-avatar">🥊</div>
                        <div class="profile-info">
                            <h3 id="career-fighter-name">Your Fighter</h3>
                            <div class="record" id="career-record">Record: 0-0-0</div>
                            <div class="specialty-display" id="career-specialty">Specialty: None</div>
                        </div>
                    </div>
                </div>
                
                <div class="career-opponents">
                    <h4 style="text-align: center; margin-bottom: 20px; color: #333;">Fight Your Way Through The Rankings</h4>
                    <div class="opponent-list" id="opponent-list">
                        <!-- Opponents will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="career-controls">
                    <button class="career-btn" onclick="showGameMainMenu()">← Back to Game Menu</button>
                    <button class="career-btn reset-career-btn" onclick="resetCareer()">🔄 Reset Career</button>
                </div>
            </div>
            
            <!-- Round Selection Screen -->
            <div id="round-selection" class="fighter-selection-screen" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 30px; color: #333;">Choose Fight Length</h3>
                <div class="fighter-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div class="fighter-card" onclick="selectRounds(3)">
                        <div class="fighter-avatar">3️⃣</div>
                        <h4>3 Rounds</h4>
                        <p>Quick Fight</p>
                        <div class="fighter-stats">30 Total Attacks</div>
                    </div>
                    <div class="fighter-card" onclick="selectRounds(5)">
                        <div class="fighter-avatar">5️⃣</div>
                        <h4>5 Rounds</h4>
                        <p>Standard Fight</p>
                        <div class="fighter-stats">50 Total Attacks</div>
                    </div>
                    <div class="fighter-card" onclick="selectRounds(8)">
                        <div class="fighter-avatar">8️⃣</div>
                        <h4>8 Rounds</h4>
                        <p>Championship Fight</p>
                        <div class="fighter-stats">80 Total Attacks</div>
                    </div>
                    <div class="fighter-card" onclick="selectRounds(10)">
                        <div class="fighter-avatar">🔟</div>
                        <h4>10 Rounds</h4>
                        <p>Title Fight</p>
                        <div class="fighter-stats">100 Total Attacks</div>
                    </div>
                    <div class="fighter-card" onclick="selectRounds(12)">
                        <div class="fighter-avatar">🏆</div>
                        <h4>12 Rounds</h4>
                        <p>World Championship</p>
                        <div class="fighter-stats">120 Total Attacks</div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: center; margin-top: 30px;">
                    <button class="career-btn back-career-btn" onclick="showFighterSelection()">← Back</button>
                </div>
            </div>

            <!-- Fighter Selection Screen -->
            <div id="fighter-selection" class="fighter-selection-screen" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 30px; color: #333;">Choose Your Fighter</h3>
                <div class="fighter-grid">
                    <div class="fighter-card" onclick="selectFighter('dieselnoi')">
                        <div class="fighter-avatar">🦴</div>
                        <h4>Dieselnoi</h4>
                        <p>The Sky Piercing Knee</p>
                        <div class="fighter-stats">Specialty: Knees</div>
                    </div>
                    <div class="fighter-card" onclick="selectFighter('buakaw')">
                        <div class="fighter-avatar">🦵</div>
                        <h4>Buakaw</h4>
                        <p>The White Lotus</p>
                        <div class="fighter-stats">Specialty: Kicks</div>
                    </div>
                    <div class="fighter-card" onclick="selectFighter('samart')">
                        <div class="fighter-avatar">👊</div>
                        <h4>Samart Payakaroon</h4>
                        <p>The Boxing Genius</p>
                        <div class="fighter-stats">Specialty: Punches</div>
                    </div>
                    <div class="fighter-card" onclick="selectFighter('saenchai')">
                        <div class="fighter-avatar">🎭</div>
                        <h4>Saenchai</h4>
                        <p>The Showman</p>
                        <div class="fighter-stats">Specialty: All-Around</div>
                    </div>
                    <div class="fighter-card" onclick="selectFighter('sagat')">
                        <div class="fighter-avatar">👑</div>
                        <h4>Sagat Petchyindee</h4>
                        <p>The King</p>
                        <div class="fighter-stats">Specialty: Power</div>
                    </div>
                    <div class="fighter-card" onclick="selectFighter('namsaknoi')">
                        <div class="fighter-avatar">💪</div>
                        <h4>Namsaknoi</h4>
                        <p>The Emperor</p>
                        <div class="fighter-stats">Specialty: Elbows</div>
                    </div>
                    <div class="fighter-card" onclick="selectFighter('somrak')">
                        <div class="fighter-avatar">🥊</div>
                        <h4>Somrak Khamsing</h4>
                        <p>The Golden Kicker</p>
                        <div class="fighter-stats">Specialty: Speed</div>
                    </div>
                    <div class="fighter-card" onclick="selectFighter('yodsanklai')">
                        <div class="fighter-avatar">⚡</div>
                        <h4>Yodsanklai Fairtex</h4>
                        <p>The Boxing Computer</p>
                        <div class="fighter-stats">Specialty: Technique</div>
                    </div>
                    <div class="fighter-card" onclick="selectFighter('johnwayne')">
                        <div class="fighter-avatar">🇦🇺</div>
                        <h4>John Wayne Parr</h4>
                        <p>The Gunslinger</p>
                        <div class="fighter-stats">Specialty: Heart</div>
                    </div>
                    <div class="fighter-card" onclick="selectFighter('petchboonchu')">
                        <div class="fighter-avatar">🤼</div>
                        <h4>Petchboonchu</h4>
                        <p>The Clinch King</p>
                        <div class="fighter-stats">Specialty: Clinch</div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: center; margin-top: 30px;">
                    <button class="career-btn back-career-btn" onclick="showRoundSelection()">← Back</button>
                </div>
            </div>

            <!-- Battle Screen -->
            <div id="battle-screen" class="battle-screen" style="display: none;">
                <!-- Combat Rules -->
                <div class="combat-rules" id="combat-rules">
                    <div class="rules-header" onclick="toggleRules()">
                        <h4>⚔️ Strategic Combat Rules</h4>
                        <span class="rules-toggle" id="rules-toggle">▼</span>
                    </div>
                    <div class="rules-content" id="rules-content">
                        <div class="rules-section">
                            <li><strong>Round System:</strong> Each round = 10 attacks from each fighter</li>
                        </div>

                        <!-- Offense Section -->
                        <div class="rules-section">
                            <div class="rules-subsection-header" onclick="toggleRulesSubsection('offense-rules')">
                                <span class="rules-subsection-title">⚔️ Offense</span>
                                <span class="rules-subsection-toggle" id="offense-toggle">▼</span>
                            </div>
                            <div class="rules-subsection-content" id="offense-rules">
                                <ul class="rules-list">
                                    <li><strong>Base Damage:</strong> All attacks deal 3 damage</li>
                                    <li><strong>🤼 Clinch System:</strong> Full plum & outside bicep initiate clinch with control</li>
                                    <li><strong>🔥 Clinch Control:</strong> When controlling clinch, knees/elbows get +5 damage</li>
                                    <li><strong>🌪️ Sweep:</strong> Knockdown: 1 damage + opponent loses 2 moral + breaks clinch</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Counters Section -->
                        <div class="rules-section">
                            <div class="rules-subsection-header" onclick="toggleRulesSubsection('counters-rules')">
                                <span class="rules-subsection-title">🎯 Counters</span>
                                <span class="rules-subsection-toggle" id="counters-toggle">▼</span>
                            </div>
                            <div class="rules-subsection-content" id="counters-rules">
                                <ul class="rules-list">
                                    <li><strong>Punch vs Kick:</strong> Punch +2 damage, Kick -1 damage</li>
                                    <li><strong>Punch vs Elbow:</strong> Elbow +2 damage, Punch -1 damage</li>
                                    <li><strong>Elbow vs Knee:</strong> Knee +2 damage, Elbow -1 damage</li>
                                    <li><strong>Kick vs Knee:</strong> Kick +2 damage, Knee -1 damage</li>
                                    <li><strong>Teep vs Kick:</strong> Teep +3 damage, Kick normal</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Defense Section -->
                        <div class="rules-section">
                            <div class="rules-subsection-header" onclick="toggleRulesSubsection('defense-rules')">
                                <span class="rules-subsection-title">🛡️ Defense</span>
                                <span class="rules-subsection-toggle" id="defense-toggle">▼</span>
                            </div>
                            <div class="rules-subsection-content" id="defense-rules">
                                <ul class="rules-list">
                                    <li><strong>Same Attacks:</strong> Both attacks -1 damage</li>
                                    <li><strong>Block:</strong> +1 health (+2 extra per consecutive block)</li>
                                    <li><strong>💪 Pummel:</strong> Reverses clinch control or initiates clinch from neutral</li>
                                    <li><strong>🛡️ Knee Shield:</strong> Defensive block that counters round knees and other attacks</li>
                                    <li><strong>🏃 Escape:</strong> Breaks clinch and returns to normal fighting</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Clinch Section -->
                        <div class="rules-section">
                            <div class="rules-subsection-header" onclick="toggleRulesSubsection('clinch-rules')">
                                <span class="rules-subsection-title">🤼 Clinch</span>
                                <span class="rules-subsection-toggle" id="clinch-toggle">▼</span>
                            </div>
                            <div class="rules-subsection-content" id="clinch-rules">
                                <ul class="rules-list">
                                    <li><strong>🤼 Clinch System:</strong> Full plum & outside bicep initiate clinch with control</li>
                                    <li><strong>💪 Pummel:</strong> Reverses clinch control or initiates clinch from neutral</li>
                                    <li><strong>🔥 Clinch Control:</strong> When controlling clinch, knees/elbows get +5 damage</li>
                                    <li><strong>🌪️ Sweep:</strong> Knockdown: 1 damage + opponent loses 2 moral + breaks clinch</li>
                                    <li><strong>🔄 Round Knee:</strong> Does 4 damage unless blocked by knee shield or countered by escape</li>
                                    <li><strong>📐 Angled Knee:</strong> Reverses clinch control when used by non-controlling fighter</li>
                                    <li><strong>🏃 Escape:</strong> Breaks clinch and returns to normal fighting</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Ways to Win Section -->
                        <div class="rules-section">
                            <div class="rules-subsection-header" onclick="toggleRulesSubsection('ways-to-win-rules')">
                                <span class="rules-subsection-title">🏆 Ways to Win</span>
                                <span class="rules-subsection-toggle" id="ways-to-win-toggle">▼</span>
                            </div>
                            <div class="rules-subsection-content" id="ways-to-win-rules">
                                <ul class="rules-list">
                                    <li><strong>💫 Rocked Status:</strong> Win 2 exchanges in a row (-2 damage, -1 heal, +2 damage taken for 2 rounds)</li>
                                    <li><strong>⚡ Flash Knockout:</strong> 0.5% chance when winning - instant victory!</li>
                                    <li><strong>🔥 Technical Knockout:</strong> Win 4 consecutive exchanges!</li>
                                    <li><strong>🏆 Judges Decision:</strong> Based on health, attacks landed, and exchanges won</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Moral System Section -->
                        <div class="rules-section">
                            <div class="rules-subsection-header" onclick="toggleRulesSubsection('moral-system-rules')">
                                <span class="rules-subsection-title">💯 Moral System</span>
                                <span class="rules-subsection-toggle" id="moral-system-toggle">▼</span>
                            </div>
                            <div class="rules-subsection-content" id="moral-system-rules">
                                <ul class="rules-list">
                                    <li><strong>💯 Moral System:</strong> Attacks landed +1, exchanges won +2 moral</li>
                                    <li><strong>🔥 15+ Moral Bonus:</strong> +2 health per action</li>
                                    <li><strong>🔥 50+ Moral Bonus:</strong> +10 attack damage</li>
                                    <li><strong>🔥 100 Moral Bonus:</strong> Knockout with any hit</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Round Info -->
                <div class="round-info">
                    <div class="round-counter">Round <span id="current-round">1</span> / <span id="max-rounds">3</span></div>
                    <div class="turn-indicator" id="turn-indicator">Your Turn</div>
                    <div class="timer-display" id="attacks-counter">
                        Attacks: <span id="attacks-in-round">0</span> / <span id="max-attacks-per-round">10</span>
                    </div>
                </div>



                <!-- Fighter Display -->
                <div class="battle-arena">
                    <div class="fighter-display">
                        <div class="fighter-info player-fighter">
                            <div class="fighter-name" id="player-fighter-name">Your Fighter</div>
                            <div class="fighter-avatar-large" id="player-avatar">🥊</div>
                            <div class="health-bar">
                                <div class="health-label">HP</div>
                                <div class="health-bar-container">
                                    <div class="health-bar-fill" id="player-health-bar" style="width: 100%"></div>
                                    <div class="health-text"><span id="player-health">100</span>/100</div>
                                </div>
                            </div>
                            <div class="stat-circles">
                                <div class="stat-circle">
                                    <div class="stat-circle-value" id="attack-counter">0</div>
                                    <div class="stat-circle-label">Attacks</div>
                                </div>
                                <div class="stat-circle">
                                    <div class="stat-circle-value" id="block-counter">0</div>
                                    <div class="stat-circle-label">Blocks</div>
                                </div>
                                <div class="stat-circle">
                                    <div class="stat-circle-value" id="counter-counter">0</div>
                                    <div class="stat-circle-label">Exchanges</div>
                                    <div class="stat-circle-label">Won</div>
                                </div>
                                <div class="stat-circle">
                                    <div class="stat-circle-value" id="player-moral">0</div>
                                    <div class="stat-circle-label">Moral</div>
                                </div>
                                <div class="stat-circle">
                                    <div class="stat-circle-value clinch-status-circle" id="clinch-status-circle">📏</div>
                                    <div class="stat-circle-label" id="clinch-status-label">Distance</div>
                                </div>
                            </div>
                        </div>

                        <div class="vs-display">VS</div>

                        <div class="fighter-info opponent-fighter">
                            <div class="fighter-name" id="opponent-fighter-name">Opponent</div>
                            <div class="fighter-avatar-large" id="opponent-avatar">🥊</div>
                            <div class="health-bar">
                                <div class="health-label">HP</div>
                                <div class="health-bar-container">
                                    <div class="health-bar-fill" id="opponent-health-bar" style="width: 100%"></div>
                                    <div class="health-text"><span id="opponent-health">100</span>/100</div>
                                </div>
                            </div>
                            <div class="stat-circles">
                                <div class="stat-circle">
                                    <div class="stat-circle-value" id="opponent-attack-counter">0</div>
                                    <div class="stat-circle-label">Attacks</div>
                                </div>
                                <div class="stat-circle">
                                    <div class="stat-circle-value" id="opponent-block-counter">0</div>
                                    <div class="stat-circle-label">Blocks</div>
                                </div>
                                <div class="stat-circle">
                                    <div class="stat-circle-value" id="opponent-counter-counter">0</div>
                                    <div class="stat-circle-label">Exchanges</div>
                                    <div class="stat-circle-label">Won</div>
                                </div>
                                <div class="stat-circle">
                                    <div class="stat-circle-value" id="opponent-moral">0</div>
                                    <div class="stat-circle-label">Moral</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Clinch Status Display (Hidden - using compact tracker instead) -->
                    <div class="clinch-status-display" id="clinch-status-display" style="display: none;">
                        <div class="clinch-indicator">
                            <div class="clinch-fighters">
                                <div class="clinch-fighter player-clinch" id="player-clinch-status">
                                    <div class="clinch-avatar" id="player-clinch-avatar">🥊</div>
                                    <div class="clinch-name" id="player-clinch-name">You</div>
                                    <div class="clinch-control-indicator" id="player-control-indicator">🤼</div>
                                </div>
                                
                                <div class="clinch-connector">
                                    <div class="clinch-lock-icon">🔗</div>
                                    <div class="clinch-status-text" id="clinch-status-text">CLINCHED</div>
                                </div>
                                
                                <div class="clinch-fighter opponent-clinch" id="opponent-clinch-status">
                                    <div class="clinch-avatar" id="opponent-clinch-avatar">🥊</div>
                                    <div class="clinch-name" id="opponent-clinch-name">Opponent</div>
                                    <div class="clinch-control-indicator" id="opponent-control-indicator">🤼</div>
                                </div>
                            </div>
                            
                            <div class="clinch-control-text" id="clinch-control-text">
                                🤼 YOU CONTROL THE CLINCH! (+5 damage with knees/elbows)
                            </div>
                        </div>
                    </div>

                    <!-- Action Display -->
                    <div class="action-display" id="action-display">
                        <div class="action-text" id="action-text">Choose your attack!</div>
                    </div>

                    <!-- Attack History Display -->
                    <div class="attack-history-container">
                        <div class="player-attack-history" id="player-attack-history">
                            <div class="attack-history-label">Your Last Attack</div>
                            <div class="attack-history-content">
                                <div class="attack-icon" id="player-last-attack-icon">⚔️</div>
                                <div class="attack-details">
                                    <div class="attack-name" id="player-last-attack-name">Ready to Fight</div>
                                    <div class="attack-power" id="player-last-attack-power">0 DMG</div>
                                </div>
                            </div>
                        </div>

                        <div class="vs-connector">
                            <div class="connector-line"></div>
                            <div class="vs-circle">VS</div>
                        </div>

                        <div class="opponent-attack-history" id="opponent-attack-history">
                            <div class="attack-history-label">Opponent's Last Attack</div>
                            <div class="attack-history-content">
                                <div class="attack-details">
                                    <div class="attack-name" id="opponent-last-attack-name">Ready to Fight</div>
                                    <div class="attack-power" id="opponent-last-attack-power">0 DMG</div>
                                </div>
                                <div class="attack-icon" id="opponent-last-attack-icon">⚔️</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tactical Menu -->
                <div class="tactical-menu" id="tactical-menu">
                    <div class="menu-categories">
                        <button class="category-btn attack-category" onclick="showAttackMenu()">
                            <span class="category-icon">⚔️</span>
                            <span class="category-name">Attacks</span>
                        </button>
                        <button class="category-btn defense-category" onclick="showDefenseMenu()">
                            <span class="category-icon">🛡️</span>
                            <span class="category-name">Defense</span>
                        </button>
                        <button class="category-btn clinch-category" onclick="showClinchMenu()">
                            <span class="category-icon">🤼</span>
                            <span class="category-name">Clinch</span>
                        </button>
                    </div>
                </div>

                <!-- Attack Buttons -->
                <div class="attack-buttons" id="attack-buttons" style="display: none;">
                    <button class="attack-btn" onclick="selectAttack('punch')">
                        <span class="attack-icon">👊</span>
                        <span class="attack-name">Punch</span>
                        <span class="attack-damage">3 DMG</span>
                    </button>
                    <button class="attack-btn" onclick="selectAttack('kick')">
                        <span class="attack-icon">🦵</span>
                        <span class="attack-name">Kick</span>
                        <span class="attack-damage">3 DMG</span>
                    </button>
                    <button class="attack-btn" onclick="selectAttack('elbow')">
                        <span class="attack-icon">💪</span>
                        <span class="attack-name">Elbow</span>
                        <span class="attack-damage">3 DMG</span>
                    </button>
                    <button class="attack-btn" onclick="selectAttack('knee')">
                        <span class="attack-icon">🦴</span>
                        <span class="attack-name">Knee</span>
                        <span class="attack-damage">3 DMG</span>
                    </button>
                    <button class="attack-btn teep-btn" onclick="selectAttack('teep')">
                        <span class="attack-icon">🦶</span>
                        <span class="attack-name">Teep</span>
                        <span class="attack-damage">3 DMG</span>
                    </button>
                    <button class="attack-btn back-to-menu-btn" onclick="showTacticalMenu()">
                        <span style="font-size: 2rem;">←</span>
                        <span style="font-size: 1.1rem; font-weight: bold;">Back to Menu</span>
                    </button>
                </div>

                <!-- Controlled Attack Buttons (when in grappling control) -->
                <div class="attack-buttons" id="controlled-attack-buttons" style="display: none;">
                    <button class="attack-btn" onclick="selectAttack('round-knee')">
                        <span class="attack-icon">🔄</span>
                        <span class="attack-name">Round Knee</span>
                        <span class="attack-damage">4 DMG</span>
                    </button>
                    <button class="attack-btn" onclick="selectAttack('angled-knee')">
                        <span class="attack-icon">📐</span>
                        <span class="attack-name">Angled Knee</span>
                        <span class="attack-damage">3 DMG + Control Switch</span>
                    </button>
                    <button class="attack-btn" onclick="selectAttack('elbow')">
                        <span class="attack-icon">💪</span>
                        <span class="attack-name">Elbow</span>
                        <span class="attack-damage">3 DMG</span>
                    </button>
                    <button class="attack-btn back-to-menu-btn" onclick="showTacticalMenu()">
                        <span style="font-size: 2rem;">←</span>
                        <span style="font-size: 1.1rem; font-weight: bold;">Back to Menu</span>
                    </button>
                </div>

                <!-- Defense Buttons -->
                <div class="defense-buttons" id="defense-buttons" style="display: none;">
                    <button class="attack-btn block-btn" onclick="selectAttack('block')">
                        <span class="attack-icon">🛡️</span>
                        <span class="attack-name">Block</span>
                        <span class="attack-damage">+1 HP (+2 per consecutive)</span>
                    </button>
                    <button class="attack-btn slip-btn" onclick="selectAttack('slip')">
                        <span class="attack-icon">🌪️</span>
                        <span class="attack-name">Slip</span>
                        <span class="attack-damage">Counter punches/elbows</span>
                    </button>
                    <button class="attack-btn roll-btn" onclick="selectAttack('roll')">
                        <span class="attack-icon">🔄</span>
                        <span class="attack-name">Roll</span>
                        <span class="attack-damage">Counter punches/elbows</span>
                    </button>
                    <button class="attack-btn evade-btn" onclick="selectAttack('evade')">
                        <span class="attack-icon">💨</span>
                        <span class="attack-name">Evade</span>
                        <span class="attack-damage">Avoid all attacks</span>
                    </button>
                    <button class="attack-btn check-btn" onclick="selectAttack('check')">
                        <span class="attack-icon">🦵</span>
                        <span class="attack-name">Check</span>
                        <span class="attack-damage">Counter kicks</span>
                    </button>
                    <button class="attack-btn parry-btn" onclick="selectAttack('parry')">
                        <span class="attack-icon">✋</span>
                        <span class="attack-name">Parry</span>
                        <span class="attack-damage">Redirect punches & teeps</span>
                    </button>
                    <button class="attack-btn knee-shield-btn" id="knee-shield-btn" onclick="selectAttack('knee-shield')" style="display: none;">
                        <span class="attack-icon">🛡️</span>
                        <span class="attack-name">Knee Shield</span>
                        <span class="attack-damage">Counter round knees</span>
                    </button>
                    <button class="attack-btn back-to-menu-btn" onclick="showTacticalMenu()">
                        <span style="font-size: 2rem;">←</span>
                        <span style="font-size: 1.1rem; font-weight: bold;">Back to Menu</span>
                    </button>
                </div>

                <!-- Clinch Buttons -->
                <div class="defense-buttons" id="clinch-buttons" style="display: none;">
                    <button class="attack-btn full-plum-btn" onclick="selectAttack('full-plum')">
                        <span class="attack-icon">🤼</span>
                        <span class="attack-name">Full Plum</span>
                        <span class="attack-damage">Dominant control + knee damage</span>
                    </button>
                    <button class="attack-btn inside-bicep-btn" onclick="selectAttack('pummel')">
                        <span class="attack-icon">💪</span>
                        <span class="attack-name">Pummel</span>
                        <span class="attack-damage">Switch control position</span>
                    </button>
                    <button class="attack-btn outside-bicep-btn" onclick="selectAttack('outside-bicep')">
                        <span class="attack-icon">🔄</span>
                        <span class="attack-name">Outside Bicep Control</span>
                        <span class="attack-damage">Gain control position</span>
                    </button>
                    <button class="attack-btn sweep-btn" onclick="selectAttack('sweep')">
                        <span class="attack-icon">🌪️</span>
                        <span class="attack-name">Sweep</span>
                        <span class="attack-damage">Knockdown: 1 DMG + 2 moral loss</span>
                    </button>
                    <button class="attack-btn escape-btn" onclick="selectAttack('escape')">
                        <span class="attack-icon">🏃</span>
                        <span class="attack-name">Escape</span>
                        <span class="attack-damage">Break free from clinch</span>
                    </button>
                    <button class="attack-btn back-to-menu-btn" onclick="showTacticalMenu()">
                        <span style="font-size: 2rem;">←</span>
                        <span style="font-size: 1.1rem; font-weight: bold;">Back to Menu</span>
                    </button>
                </div>

                <!-- Timer Popup -->
                <div id="timer-popup" class="timer-popup" style="display: none;">
                    <h3>⏰ Next Round starts in:</h3>
                    <div class="timer-clock" id="timer-clock">1:00</div>
                    <div class="timer-message">Choose healing option or continue fighting!</div>
                    <div class="healing-options">
                        <button class="healing-btn" onclick="selectMidRoundHealing('water')">
                            <span class="healing-icon">💧</span>
                            <span class="healing-name">Water</span>
                            <span class="healing-effect">+3 HP, +1 to next 3 attacks</span>
                        </button>
                        <button class="healing-btn" onclick="selectMidRoundHealing('ice')">
                            <span class="healing-icon">🧊</span>
                            <span class="healing-name">Ice Pack</span>
                            <span class="healing-effect">+3 to next block</span>
                        </button>
                        <button class="healing-btn" onclick="selectMidRoundHealing('enswell')">
                            <span class="healing-icon">🔧</span>
                            <span class="healing-name">Enswell</span>
                            <span class="healing-effect">-3 to next opponent punch</span>
                        </button>
                        <button class="healing-btn" onclick="selectMidRoundHealing('motivate')">
                            <span class="healing-icon">💪</span>
                            <span class="healing-name">Motivate</span>
                            <span class="healing-effect">+10 to next winning exchange</span>
                        </button>
                    </div>
                </div>

                <!-- Corner Break Screen -->
                <div id="corner-break" class="corner-break-screen" style="display: none;">
                    <div class="corner-break-header">
                        <h3>🛑 CORNER BREAK - 1 MINUTE REST</h3>
                        <div class="rest-timer">Time Remaining: <span id="rest-timer-value">60</span>s</div>
                    </div>
                    <div class="corner-instructions">
                        <p>Choose your corner assistance to recover +5 health:</p>
                    </div>
                    <div class="corner-buttons">
                        <button class="corner-btn" onclick="selectCornerChoice('water')">
                            <span class="corner-icon">💧</span>
                            <span class="corner-name">Water</span>
                            <span class="corner-effect">+3 HP, +1 to next 3 attacks</span>
                        </button>
                        <button class="corner-btn" onclick="selectCornerChoice('ice')">
                            <span class="corner-icon">🧊</span>
                            <span class="corner-name">Ice Pack</span>
                            <span class="corner-effect">+3 to next block</span>
                        </button>
                        <button class="corner-btn" onclick="selectCornerChoice('enswell')">
                            <span class="corner-icon">🔧</span>
                            <span class="corner-name">Enswell</span>
                            <span class="corner-effect">-3 to next opponent punch</span>
                        </button>
                        <button class="corner-btn" onclick="selectCornerChoice('motivate')">
                            <span class="corner-icon">💪</span>
                            <span class="corner-name">Motivate</span>
                            <span class="corner-effect">+10 to next winning exchange</span>
                        </button>
                    </div>
                    <div class="corner-status" id="corner-status">Make your choice...</div>
                </div>

                <!-- Game Controls -->
                <div class="game-controls">
                    <button class="control-btn" onclick="resetBattle()">🔄 New Fight</button>
                    <button class="control-btn" onclick="showFighterSelection()">👥 Change Fighter</button>
                    <button class="control-btn" onclick="showRulesPopup()">⚔️ Rules</button>
                </div>

                <!-- Rules Popup Modal -->
                <div id="rules-popup" class="rules-popup-overlay" style="display: none;">
                    <div class="rules-popup-container">
                        <div class="rules-popup-header">
                            <h3>⚔️ Strategic Combat Rules</h3>
                            <button class="rules-close-btn" onclick="closeRulesPopup()">✕</button>
                        </div>
                        <div class="rules-popup-content">
                            <div class="rules-section">
                                <ul class="rules-list">
                                    <li><strong>Fight Length:</strong> Fights can be 3, 5, 8, 10, or 12 Rounds</li>
                                    <li><strong>Round System:</strong> Each round = 10 attacks from each fighter</li>
                                </ul>
                            </div>



                            <!-- Offense Section -->
                            <div class="rules-section">
                                <div class="rules-subsection-header" onclick="toggleRulesSubsection('popup-offense-rules')">
                                    <span class="rules-subsection-title">⚔️ Offense</span>
                                    <span class="rules-subsection-toggle" id="popup-offense-toggle">▼</span>
                                </div>
                                <div class="rules-subsection-content" id="popup-offense-rules">
                                    <ul class="rules-list">
                                        <li><strong>Base Damage:</strong> All attacks deal 3 damage</li>
                                        <li><strong>🤼 Clinch System:</strong> Full plum & outside bicep initiate clinch with control</li>
                                        <li><strong>🔥 Clinch Control:</strong> When controlling clinch, knees/elbows get +5 damage</li>
                                        <li><strong>🌪️ Sweep:</strong> Knockdown: 1 damage + opponent loses 2 moral + breaks clinch</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Counters Section -->
                            <div class="rules-section">
                                <div class="rules-subsection-header" onclick="toggleRulesSubsection('popup-counters-rules')">
                                    <span class="rules-subsection-title">🎯 Counters</span>
                                    <span class="rules-subsection-toggle" id="popup-counters-toggle">▼</span>
                                </div>
                                <div class="rules-subsection-content" id="popup-counters-rules">
                                    <ul class="rules-list">
                                        <li><strong>Punch vs Kick:</strong> Punch +2 damage, Kick -1 damage</li>
                                        <li><strong>Punch vs Elbow:</strong> Elbow +2 damage, Punch -1 damage</li>
                                        <li><strong>Elbow vs Knee:</strong> Knee +2 damage, Elbow -1 damage</li>
                                        <li><strong>Kick vs Knee:</strong> Kick +2 damage, Knee -1 damage</li>
                                        <li><strong>Teep vs Kick:</strong> Teep +3 damage, Kick normal</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Defense Section -->
                            <div class="rules-section">
                                <div class="rules-subsection-header" onclick="toggleRulesSubsection('popup-defense-rules')">
                                    <span class="rules-subsection-title">🛡️ Defense</span>
                                    <span class="rules-subsection-toggle" id="popup-defense-toggle">▼</span>
                                </div>
                                <div class="rules-subsection-content" id="popup-defense-rules">
                                    <ul class="rules-list">
                                        <li><strong>Same Attacks:</strong> Both attacks -1 damage</li>
                                        <li><strong>Block:</strong> +1 health (+2 extra per consecutive block)</li>
                                        <li><strong>💪 Pummel:</strong> Reverses clinch control or initiates clinch from neutral</li>
                                        <li><strong>🛡️ Knee Shield:</strong> Defensive block that counters round knees and other attacks</li>
                                        <li><strong>🏃 Escape:</strong> Breaks clinch and returns to normal fighting</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Clinch Section -->
                            <div class="rules-section">
                                <div class="rules-subsection-header" onclick="toggleRulesSubsection('popup-clinch-rules')">
                                    <span class="rules-subsection-title">🤼 Clinch</span>
                                    <span class="rules-subsection-toggle" id="popup-clinch-toggle">▼</span>
                                </div>
                                <div class="rules-subsection-content" id="popup-clinch-rules">
                                    <ul class="rules-list">
                                        <li><strong>🤼 Clinch System:</strong> Full plum & outside bicep initiate clinch with control</li>
                                        <li><strong>💪 Pummel:</strong> Reverses clinch control or initiates clinch from neutral</li>
                                        <li><strong>🔥 Clinch Control:</strong> When controlling clinch, knees/elbows get +5 damage</li>
                                        <li><strong>🌪️ Sweep:</strong> Knockdown: 1 damage + opponent loses 2 moral + breaks clinch</li>
                                        <li><strong>🔄 Round Knee:</strong> Does 4 damage unless blocked by knee shield or countered by escape</li>
                                        <li><strong>📐 Angled Knee:</strong> Reverses clinch control when used by non-controlling fighter</li>
                                        <li><strong>🏃 Escape:</strong> Breaks clinch and returns to normal fighting</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Ways to Win Section -->
                            <div class="rules-section">
                                <div class="rules-subsection-header" onclick="toggleRulesSubsection('popup-ways-to-win-rules')">
                                    <span class="rules-subsection-title">🏆 Ways to Win</span>
                                    <span class="rules-subsection-toggle" id="popup-ways-to-win-toggle">▼</span>
                                </div>
                                <div class="rules-subsection-content" id="popup-ways-to-win-rules">
                                    <ul class="rules-list">
                                        <li><strong>💫 Rocked Status:</strong> Win 2 exchanges in a row (-2 damage, -1 heal, +2 damage taken for 2 rounds)</li>
                                        <li><strong>⚡ Flash Knockout:</strong> 0.5% chance when winning - instant victory!</li>
                                        <li><strong>🔥 Technical Knockout:</strong> Win 4 consecutive exchanges!</li>
                                        <li><strong>🏆 Judges Decision:</strong> Based on health, attacks landed, and exchanges won</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Moral System Section -->
                            <div class="rules-section">
                                <div class="rules-subsection-header" onclick="toggleRulesSubsection('popup-moral-system-rules')">
                                    <span class="rules-subsection-title">💯 Moral System</span>
                                    <span class="rules-subsection-toggle" id="popup-moral-system-toggle">▼</span>
                                </div>
                                <div class="rules-subsection-content" id="popup-moral-system-rules">
                                    <ul class="rules-list">
                                        <li><strong>💯 Moral System:</strong> Attacks landed +1, exchanges won +2 moral</li>
                                        <li><strong>🔥 15+ Moral Bonus:</strong> +2 health per action</li>
                                        <li><strong>🔥 50+ Moral Bonus:</strong> +10 attack damage</li>
                                        <li><strong>🔥 100 Moral Bonus:</strong> Knockout with any hit</li>
                                    </ul>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Screen -->
        <div id="history" class="screen">
            <button class="back-button" onclick="showScreen('main-menu')">← Back to Main Menu</button>
            <h2 style="text-align: center; margin-bottom: 30px; color: #333;">🏛️ History & Culture</h2>
            
            <div class="category-header">Ancient Origins</div>
            <div class="content-grid">
                <div class="content-card">
                    <h4>⚔️ Muay Boran</h4>
                    <p>The ancient battlefield art that evolved into modern Muay Thai. Originally developed for warfare, incorporating weapons training and battlefield tactics.</p>
                </div>
                <div class="content-card">
                    <h4>👑 Royal Patronage</h4>
                    <p>Kings of Siam were practitioners and promoters of the art. King Naresuan and King Tiger both were legendary fighters who elevated the sport's status.</p>
                </div>
                <div class="content-card">
                    <h4>🎭 Cultural Integration</h4>
                    <p>Muay Thai became deeply woven into Thai culture, with rituals, music, and ceremonies that honor the art's spiritual and cultural significance.</p>
                </div>
            </div>

            <div class="category-header">Sacred Traditions</div>
            <div class="content-grid">
                <div class="content-card">
                    <h4>🙏 Wai Kru Ram Muay</h4>
                    <p>Pre-fight ritual dance honoring teachers, ancestors, and the art itself. Each movement has meaning and connects fighters to their lineage.</p>
                </div>
                <div class="content-card">
                    <h4>🎵 Sarama Music</h4>
                    <p>Traditional music played during fights, with rhythm that matches the action. The music is believed to guide fighters and honor the spirits.</p>
                </div>
                <div class="content-card">
                    <h4>👑 Mongkol & Prajioud</h4>
                    <p>Sacred headband and armbands blessed by monks and teachers. These items carry spiritual protection and connect fighters to their camp's lineage.</p>
                </div>
            </div>

            <div class="category-header">Modern Evolution</div>
            <div class="content-grid">
                <div class="content-card">
                    <h4>🏟️ Stadium Era</h4>
                    <p>Lumpinee and Rajadamnern stadiums became the holy grails of Muay Thai. Fighting at these venues represents the pinnacle of the sport.</p>
                </div>
                <div class="content-card">
                    <h4>🌍 Global Expansion</h4>
                    <p>From the 1980s onward, Muay Thai spread worldwide. International fighters began training in Thailand and competing at the highest levels.</p>
                </div>
                <div class="content-card">
                    <h4>📺 Modern Media</h4>
                    <p>Television and internet brought Muay Thai to global audiences. Modern promotions like ONE Championship showcase the art to millions worldwide.</p>
                </div>
            </div>

            <div class="category-header">Cultural Impact</div>
            <div class="content-grid">
                <div class="content-card">
                    <h4>🏫 Training Culture</h4>
                    <p>Traditional camp life where fighters live, train, and compete together. This system creates bonds and preserves the art's authentic culture.</p>
                </div>
                <div class="content-card">
                    <h4>🎬 Popular Culture</h4>
                    <p>Muay Thai in movies, documentaries, and media has spread awareness of Thai culture and values alongside the martial art itself.</p>
                </div>
            </div>
        </div>

        <!-- Individual Technique Detail Screens (keeping existing ones and adding new clinch techniques) -->
        
        <!-- Existing technique screens remain the same... -->
        <div id="detail-jab" class="screen">
            <button class="back-button" onclick="showScreen('techniques')">← Back to Techniques</button>
            <div class="technique-header">
                <h2 class="technique-title">Jab</h2>
                <div class="thai-pronunciation">
                    <h4>Thai Name:</h4>
                    <div class="thai-text">หมัดตรง (Mat Trong)</div>
                </div>
            </div>
            
            <div class="technique-image">
                <svg width="300" height="200" viewBox="0 0 300 200">
                    <circle cx="80" cy="60" r="25" fill="#ffeaa7" stroke="#fdcb6e" stroke-width="2"/>
                    <rect x="70" y="85" width="20" height="40" fill="#74b9ff" rx="5"/>
                    <rect x="60" y="90" width="40" height="8" fill="#fd79a8" rx="4"/>
                    <line x1="100" y1="95" x2="180" y2="95" stroke="#e17055" stroke-width="6" stroke-linecap="round"/>
                    <polygon points="180,90 190,95 180,100" fill="#e17055"/>
                    <text x="150" y="130" text-anchor="middle" fill="#2d3436" font-size="14" font-weight="bold">JAB</text>
                </svg>
            </div>

            <div class="description">
                <h4>Description:</h4>
                <p>The jab is a quick, straight punch thrown with the lead hand. It's the most fundamental punch in Muay Thai and boxing. The jab is used to gauge distance, set up combinations, and keep opponents at bay. It should be thrown with speed and precision rather than power, snapping back quickly to maintain guard position.</p>
            </div>

            <div class="video-section">
                <div class="video-container">
                    <h4>🎯 Training Tutorial</h4>
                    <div class="video-placeholder" onclick="playVideo('jab-tutorial')">
                        <div class="play-button">▶</div>
                    </div>
                    <p style="color: white; font-size: 0.9rem;">Learn proper jab technique and form</p>
                </div>
                <div class="video-container">
                    <h4>🥊 Live Fight Usage</h4>
                    <div class="video-placeholder" onclick="playVideo('jab-fight')">
                        <div class="play-button">▶</div>
                    </div>
                    <p style="color: white; font-size: 0.9rem;">See jabs used in professional fights</p>
                </div>
            </div>
        </div>

        <!-- New Clinch Technique Screens -->
        <div id="detail-plum-clinch" class="screen">
            <button class="back-button" onclick="showScreen('techniques')">← Back to Techniques</button>
            <div class="technique-header">
                <h2 class="technique-title">Plum Clinch</h2>
                <div class="thai-pronunciation">
                    <h4>Thai Name:</h4>
                    <div class="thai-text">จับคอ (Jab Kor)</div>
                </div>
            </div>
            
            <div class="technique-image">
                <svg width="300" height="200" viewBox="0 0 300 200">
                    <circle cx="80" cy="60" r="25" fill="#ffeaa7" stroke="#fdcb6e" stroke-width="2"/>
                    <circle cx="180" cy="60" r="25" fill="#ffeaa7" stroke="#fdcb6e" stroke-width="2"/>
                    <rect x="70" y="85" width="20" height="40" fill="#74b9ff" rx="5"/>
                    <rect x="170" y="85" width="20" height="40" fill="#fd79a8" rx="5"/>
                    <path d="M 60 90 Q 130 70 200 90" stroke="#e17055" stroke-width="8" fill="none"/>
                    <path d="M 200 90 Q 130 70 60 90" stroke="#e17055" stroke-width="8" fill="none"/>
                    <text x="130" y="150" text-anchor="middle" fill="#2d3436" font-size="12" font-weight="bold">PLUM CLINCH</text>
                </svg>
            </div>

            <div class="description">
                <h4>Description:</h4>
                <p>The plum clinch is the most dominant position in Muay Thai clinch work. Both hands control the back of the opponent's head/neck, allowing you to pull them down while driving knees upward. This position provides maximum control and the ability to deliver devastating knee strikes while limiting the opponent's options.</p>
            </div>

            <div class="video-section">
                <div class="video-container">
                    <h4>🎯 Training Tutorial</h4>
                    <div class="video-placeholder" onclick="playVideo('plum-clinch-tutorial')">
                        <div class="play-button">▶</div>
                    </div>
                    <p style="color: white; font-size: 0.9rem;">Master the plum clinch position</p>
                </div>
                <div class="video-container">
                    <h4>🥊 Live Fight Usage</h4>
                    <div class="video-placeholder" onclick="playVideo('plum-clinch-fight')">
                        <div class="play-button">▶</div>
                    </div>
                    <p style="color: white; font-size: 0.9rem;">Plum clinch domination in fights</p>
                </div>
            </div>
        </div>

        <div id="detail-teep" class="screen">
            <button class="back-button" onclick="showScreen('techniques')">← Back to Techniques</button>
            <div class="technique-header">
                <h2 class="technique-title">Teep (Push Kick)</h2>
                <div class="thai-pronunciation">
                    <h4>Thai Name:</h4>
                    <div class="thai-text">ถีบ (Teep)</div>
                </div>
            </div>
            
            <div class="technique-image">
                <svg width="300" height="200" viewBox="0 0 300 200">
                    <circle cx="80" cy="60" r="25" fill="#ffeaa7" stroke="#fdcb6e" stroke-width="2"/>
                    <rect x="70" y="85" width="20" height="40" fill="#74b9ff" rx="5"/>
                    <rect x="75" y="125" width="10" height="25" fill="#00b894" rx="3"/>
                    <line x1="85" y1="150" x2="180" y2="120" stroke="#e17055" stroke-width="8" stroke-linecap="round"/>
                    <circle cx="180" cy="120" r="12" fill="#e17055"/>
                    <text x="130" y="180" text-anchor="middle" fill="#2d3436" font-size="14" font-weight="bold">TEEP</text>
                </svg>
            </div>

            <div class="description">
                <h4>Description:</h4>
                <p>The teep is a straight push kick using the ball of the foot. It's primarily used to control distance, disrupt an opponent's rhythm, and create space. The teep can target the body, solar plexus, or face. It's an essential defensive and offensive tool that requires excellent balance and timing.</p>
            </div>

            <div class="video-section">
                <div class="video-container">
                    <h4>🎯 Training Tutorial</h4>
                    <div class="video-placeholder" onclick="playVideo('teep-tutorial')">
                        <div class="play-button">▶</div>
                    </div>
                    <p style="color: white; font-size: 0.9rem;">Perfect your teep technique</p>
                </div>
                <div class="video-container">
                    <h4>🥊 Live Fight Usage</h4>
                    <div class="video-placeholder" onclick="playVideo('teep-fight')">
                        <div class="play-button">▶</div>
                    </div>
                    <p style="color: white; font-size: 0.9rem;">Teeps used in professional fights</p>
                </div>
            </div>
        </div>

        <!-- Keep all other existing technique detail screens... -->
        
        <div id="detail-roundhouse" class="screen">
            <button class="back-button" onclick="showScreen('techniques')">← Back to Techniques</button>
            <div class="technique-header">
                <h2 class="technique-title">Roundhouse Kick</h2>
                <div class="thai-pronunciation">
                    <h4>Thai Name:</h4>
                    <div class="thai-text">เตะตัด (Tae Tat)</div>
                </div>
            </div>
            
            <div class="technique-image">
                <svg width="300" height="200" viewBox="0 0 300 200">
                    <circle cx="80" cy="60" r="25" fill="#ffeaa7" stroke="#fdcb6e" stroke-width="2"/>
                    <rect x="70" y="85" width="20" height="40" fill="#74b9ff" rx="5"/>
                    <rect x="75" y="125" width="10" height="30" fill="#fd79a8" rx="3"/>
                    <path d="M 85 155 Q 150 140 200 100" stroke="#e17055" stroke-width="8" fill="none" stroke-linecap="round"/>
                    <circle cx="200" cy="100" r="8" fill="#e17055"/>
                    <text x="150" y="180" text-anchor="middle" fill="#2d3436" font-size="12" font-weight="bold">ROUNDHOUSE</text>
                </svg>
            </div>

            <div class="description">
                <h4>Description:</h4>
                <p>The roundhouse kick is the signature technique of Muay Thai. It's a circular kick that uses the shin as the striking surface. The power comes from the rotation of the entire body, starting from the planted foot, through the hips, and culminating in the shin strike. This kick can target the legs, body, or head of the opponent.</p>
            </div>

            <div class="video-section">
                <div class="video-container">
                    <h4>🎯 Training Tutorial</h4>
                    <div class="video-placeholder" onclick="playVideo('roundhouse-tutorial')">
                        <div class="play-button">▶</div>
                    </div>
                    <p style="color: white; font-size: 0.9rem;">Perfect your roundhouse technique</p>
                </div>
                <div class="video-container">
                    <h4>🥊 Live Fight Usage</h4>
                    <div class="video-placeholder" onclick="playVideo('roundhouse-fight')">
                        <div class="play-button">▶</div>
                    </div>
                    <p style="color: white; font-size: 0.9rem;">Devastating roundhouse kicks in fights</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showScreen(screenId) {
            // Hide all screens
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active');
                screen.style.display = 'none';
            });
            
            // Show selected screen
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.style.display = 'block';
                targetScreen.classList.add('active');
            }
        }

        function showTechnique(technique) {
            showScreen('detail-' + technique);
        }

        function playVideo(videoType) {
            // Create custom modal for video playback
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;

            const videoContainer = document.createElement('div');
            videoContainer.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                max-width: 500px;
                margin: 20px;
            `;

            videoContainer.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">Video: ${videoType.replace('-', ' ').toUpperCase()}</h3>
                <div style="width: 100%; height: 250px; background: linear-gradient(135deg, #636e72, #2d3436); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; margin-bottom: 20px;">
                    <div>
                        <div style="font-size: 48px; margin-bottom: 10px;">🎥</div>
                        <p>Video would play here</p>
                        <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 10px;">In a real implementation, this would connect to video hosting services</p>
                    </div>
                </div>
                <button onclick="this.closest('.video-modal').remove()" style="background: #ff6b6b; color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-size: 1rem;">Close</button>
            `;

            modal.className = 'video-modal';
            modal.appendChild(videoContainer);
            document.body.appendChild(modal);

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function playFight(fightId) {
            playVideo('fight-' + fightId);
        }

        // Battle System Logic
        let battleState = {
            playerFighter: null,
            opponentFighter: null,
            playerHealth: 100,
            opponentHealth: 100,
            currentRound: 1,
            maxRounds: 3,
            attacksInCurrentRound: 0,
            maxAttacksPerRound: 10,
            playerTurn: true,
            playerAction: null,
            opponentAction: null,
            gameActive: false,
            playerHasFirstMove: true,
            // Rest period tracking
            isRestPeriod: false,
            restTimer: 60,
            playerCornerChoice: null,
            opponentCornerChoice: null,
            waitingForCornerChoices: false,
            // Consecutive blocking tracking
            playerConsecutiveBlocks: 0,
            opponentConsecutiveBlocks: 0,
            // Rocked status tracking
            playerRockedRoundsLeft: 0,
            opponentRockedRoundsLeft: 0,
            playerConsecutiveWins: 0,
            opponentConsecutiveWins: 0,
            // Knockout tracking
            flashKnockout: null,
            consecutiveKnockout: null,
            // Stats counters (per round)
            attackCount: 0,
            blockCount: 0,
            counterCount: 0,
            opponentAttackCount: 0,
            opponentBlockCount: 0,
            opponentCounterCount: 0,
            // Total fight stats
            totalAttackCount: 0,
            totalBlockCount: 0,
            totalCounterCount: 0,
            totalOpponentAttackCount: 0,
            totalOpponentBlockCount: 0,
            totalOpponentCounterCount: 0,
            // Round-by-round health tracking for scoring
            roundHealthScores: [],
            // Career mode
            isCareerMode: false,
            currentOpponentIndex: 0,
            // Special effects tracking
            playerWaterStacks: 0,
            playerWaterAttacksLeft: 0,
            playerIceBlocksLeft: 0,
            playerEnswellPunchesLeft: 0,
            playerMotivationWinsLeft: 0,
            opponentWaterStacks: 0,
            opponentWaterAttacksLeft: 0,
            opponentIceBlocksLeft: 0,
            opponentEnswellPunchesLeft: 0,
            opponentMotivationWinsLeft: 0,
            // Defense technique tracking
            playerSlipPunchReduction: 0,
            playerSlipElbowReduction: 0,
            playerSlipNextAttackBonus: 0,
            playerRollPunchReduction: 0,
            playerRollElbowReduction: 0,
            playerRollNextAttackBonus: 0,
            playerParryNextAttackBonus: 0,
            opponentSlipPunchReduction: 0,
            opponentSlipElbowReduction: 0,
            opponentSlipNextAttackBonus: 0,
            opponentRollPunchReduction: 0,
            opponentRollElbowReduction: 0,
            opponentRollNextAttackBonus: 0,
            opponentParryNextAttackBonus: 0,
            // Clinch state tracking
            isClinched: false, // true/false if fighters are clinched
            playerHasControl: false, // true/false if player is controlling the clinch
            // Moral system tracking
            playerMoral: 0,
            opponentMoral: 0,
            playerKnockedDown: false,
            opponentKnockedDown: false
        };

        // Career Mode State
        let careerState = {
            fighterName: '',
            fighterAvatar: '',
            fighterSpecialty: '',
            wins: 0,
            losses: 0,
            draws: 0,
            defeatedOpponents: [],
            selectedAvatar: '',
            selectedSpecialty: ''
        };

        const fighters = {
            dieselnoi: { name: 'Dieselnoi', avatar: '🦴', nickname: 'The Sky Piercing Knee' },
            buakaw: { name: 'Buakaw', avatar: '🦵', nickname: 'The White Lotus' },
            samart: { name: 'Samart Payakaroon', avatar: '👊', nickname: 'The Boxing Genius' },
            saenchai: { name: 'Saenchai', avatar: '🎭', nickname: 'The Showman' },
            sagat: { name: 'Sagat Petchyindee', avatar: '👑', nickname: 'The King' },
            namsaknoi: { name: 'Namsaknoi', avatar: '💪', nickname: 'The Emperor' },
            somrak: { name: 'Somrak Khamsing', avatar: '🥊', nickname: 'The Golden Kicker' },
            yodsanklai: { name: 'Yodsanklai Fairtex', avatar: '⚡', nickname: 'The Boxing Computer' },
            johnwayne: { name: 'John Wayne Parr', avatar: '🇦🇺', nickname: 'The Gunslinger' },
            petchboonchu: { name: 'Petchboonchu', avatar: '🤼', nickname: 'The Clinch King' }
        };

        const attacks = {
            punch: { name: 'Punch', baseDamage: 3, emoji: '👊' },
            kick: { name: 'Kick', baseDamage: 3, emoji: '🦵' },
            elbow: { name: 'Elbow', baseDamage: 3, emoji: '💪' },
            knee: { name: 'Knee', baseDamage: 3, emoji: '🦴' },
            teep: { name: 'Teep', baseDamage: 3, emoji: '🦶' },
            block: { name: 'Block', baseDamage: 0, emoji: '🛡️' },
            slip: { name: 'Slip', baseDamage: 0, emoji: '🌪️' },
            roll: { name: 'Roll', baseDamage: 0, emoji: '🔄' },
            evade: { name: 'Evade', baseDamage: 0, emoji: '💨' },
            check: { name: 'Check', baseDamage: 0, emoji: '🦵' },
            parry: { name: 'Parry', baseDamage: 0, emoji: '✋' },
            'full-plum': { name: 'Full Plum', baseDamage: 0, emoji: '🤼' },
            'pummel': { name: 'Pummel', baseDamage: 0, emoji: '💪' },
            'outside-bicep': { name: 'Outside Bicep Control', baseDamage: 0, emoji: '🔄' },
            'sweep': { name: 'Sweep', baseDamage: 1, emoji: '🌪️' },
            escape: { name: 'Escape', baseDamage: 1, emoji: '🏃' },
            'round-knee': { name: 'Round Knee', baseDamage: 4, emoji: '🔄' },
            'angled-knee': { name: 'Angled Knee', baseDamage: 3, emoji: '📐' },
            'knee-shield': { name: 'Knee Shield', baseDamage: 0, emoji: '🛡️' }
        };

        function calculateDamage(playerAttack, opponentAttack) {
            let playerDamage = attacks[playerAttack].baseDamage;
            let opponentDamage = attacks[opponentAttack].baseDamage;
            let playerHealthGain = 0;
            let opponentHealthGain = 0;
            let playerGainedBonus = false;
            let opponentGainedBonus = false;

            // Handle defense techniques first
            if (isDefenseTechnique(playerAttack) || isDefenseTechnique(opponentAttack)) {
                return handleDefenseTechniques(playerAttack, opponentAttack);
            }

            // Handle round knee special damage logic first
            if (playerAttack === 'round-knee' && opponentAttack !== 'knee-shield' && opponentAttack !== 'escape') {
                playerDamage = 4; // Round knee does 4 damage unless blocked by knee shield or countered by escape
            }
            if (opponentAttack === 'round-knee' && playerAttack !== 'knee-shield' && playerAttack !== 'escape') {
                opponentDamage = 4; // Round knee does 4 damage unless blocked by knee shield or countered by escape
            }

            // Handle blocking (including knee shield)
            const playerBlocking = (playerAttack === 'block' || playerAttack === 'knee-shield');
            const opponentBlocking = (opponentAttack === 'block' || opponentAttack === 'knee-shield');
            
            if (playerBlocking && opponentBlocking) {
                // Both block - calculate consecutive blocking bonuses
                battleState.playerConsecutiveBlocks++;
                battleState.opponentConsecutiveBlocks++;
                
                playerHealthGain = 1 + (battleState.playerConsecutiveBlocks - 1) * 2;
                opponentHealthGain = 1 + (battleState.opponentConsecutiveBlocks - 1) * 2;
                playerDamage = 0;
                opponentDamage = 0;
            } else if (playerBlocking) {
                // Player blocks - gains health based on consecutive blocks
                battleState.playerConsecutiveBlocks++;
                battleState.opponentConsecutiveBlocks = 0; // Reset opponent's consecutive blocks
                
                playerHealthGain = 1 + (battleState.playerConsecutiveBlocks - 1) * 2;
                playerDamage = 0;
                opponentDamage = 0;
            } else if (opponentBlocking) {
                // Opponent blocks - gains health based on consecutive blocks
                battleState.opponentConsecutiveBlocks++;
                battleState.playerConsecutiveBlocks = 0; // Reset player's consecutive blocks
                
                opponentHealthGain = 1 + (battleState.opponentConsecutiveBlocks - 1) * 2;
                playerDamage = 0;
                opponentDamage = 0;
            } else {
                // Neither blocked - reset consecutive block counters
                battleState.playerConsecutiveBlocks = 0;
                battleState.opponentConsecutiveBlocks = 0;
                
                // Combat interactions
                if (playerAttack === opponentAttack) {
                    // Same attacks - both lose 1 damage
                    playerDamage = Math.max(1, playerDamage - 1);
                    opponentDamage = Math.max(1, opponentDamage - 1);
                } else {
                    // Rock-paper-scissors mechanics
                    if (playerAttack === 'punch' && opponentAttack === 'kick') {
                        playerDamage += 2; // Punch gains +2
                        opponentDamage -= 1; // Kick loses -1
                        playerGainedBonus = true;
                    } else if (playerAttack === 'kick' && opponentAttack === 'punch') {
                        playerDamage -= 1; // Kick loses -1
                        opponentDamage += 2; // Punch gains +2
                        opponentGainedBonus = true;
                    } else if (playerAttack === 'punch' && opponentAttack === 'elbow') {
                        playerDamage -= 1; // Punch loses -1
                        opponentDamage += 2; // Elbow gains +2
                        opponentGainedBonus = true;
                    } else if (playerAttack === 'elbow' && opponentAttack === 'punch') {
                        playerDamage += 2; // Elbow gains +2
                        opponentDamage -= 1; // Punch loses -1
                        playerGainedBonus = true;
                    } else if (playerAttack === 'elbow' && opponentAttack === 'knee') {
                        playerDamage -= 1; // Elbow loses -1
                        opponentDamage += 2; // Knee gains +2
                        opponentGainedBonus = true;
                    } else if (playerAttack === 'knee' && opponentAttack === 'elbow') {
                        playerDamage += 2; // Knee gains +2
                        opponentDamage -= 1; // Elbow loses -1
                        playerGainedBonus = true;
                    } else if (playerAttack === 'kick' && opponentAttack === 'knee') {
                        playerDamage += 2; // Kick gains +2
                        opponentDamage -= 1; // Knee loses -1
                        playerGainedBonus = true;
                    } else if (playerAttack === 'knee' && opponentAttack === 'kick') {
                        playerDamage -= 1; // Knee loses -1
                        opponentDamage += 2; // Kick gains +2
                        opponentGainedBonus = true;
                    } else if (playerAttack === 'teep' && opponentAttack === 'kick') {
                        playerDamage += 3; // Teep gains +3 vs kick
                        playerGainedBonus = true;
                    } else if (playerAttack === 'kick' && opponentAttack === 'teep') {
                        opponentDamage += 3; // Teep gains +3 vs kick
                        opponentGainedBonus = true;
                    } else if (playerAttack === 'teep' && (opponentAttack === 'knee' || opponentAttack === 'elbow')) {
                        playerDamage -= 2; // Teep loses -2 vs knee/elbow
                    } else if ((playerAttack === 'knee' || playerAttack === 'elbow') && opponentAttack === 'teep') {
                        opponentDamage -= 2; // Teep loses -2 vs knee/elbow
                    } else if (playerAttack === 'teep' && opponentAttack === 'teep') {
                        // Both teeps cancel out - no damage
                        playerDamage = 0;
                        opponentDamage = 0;
                    } else if (isClinchTechnique(playerAttack) && isClinchTechnique(opponentAttack)) {
                        // Handle clinch state transitions
                        handleClinchTransitions(playerAttack, opponentAttack);
                        
                        // Clinch vs clinch interactions (most clinch techniques do no damage, just control)
                        if (playerAttack === 'sweep' && opponentAttack !== 'sweep') {
                            // Sweep beats other clinch techniques
                            playerDamage = 1; // Base sweep damage
                        } else if (opponentAttack === 'sweep' && playerAttack !== 'sweep') {
                            // Sweep beats other clinch techniques
                            opponentDamage = 1; // Base sweep damage
                        } else if (playerAttack === 'escape' && (opponentAttack === 'full-plum' || opponentAttack === 'outside-bicep')) {
                            // Escape counters control attempts
                            playerDamage += 1;
                        } else if (opponentAttack === 'escape' && (playerAttack === 'full-plum' || playerAttack === 'outside-bicep')) {
                            // Escape counters control attempts
                            opponentDamage += 1;
                        } else {
                            // Most clinch vs clinch interactions result in no damage, just positioning
                            playerDamage = 0;
                            opponentDamage = 0;
                        }
                    } else if (isClinchTechnique(playerAttack) && !isClinchTechnique(opponentAttack)) {
                        // Clinch vs striking - clinch techniques counter strikes at close range
                        if (opponentAttack === 'punch' || opponentAttack === 'elbow') {
                            playerDamage += 1; // Clinch counters close-range strikes
                        } else if (opponentAttack === 'kick' || opponentAttack === 'teep') {
                            opponentDamage += 1; // Kicks counter clinch attempts
                        }
                    } else if (!isClinchTechnique(playerAttack) && isClinchTechnique(opponentAttack)) {
                        // Striking vs clinch
                        if (playerAttack === 'punch' || playerAttack === 'elbow') {
                            opponentDamage += 1; // Clinch counters close-range strikes
                        } else if (playerAttack === 'kick' || playerAttack === 'teep') {
                            playerDamage += 1; // Kicks counter clinch attempts
                        }
                    }
                }

                // Ensure minimum damage of 1 for non-block attacks (except teep vs teep)
                if (!(playerAttack === 'teep' && opponentAttack === 'teep')) {
                    playerDamage = Math.max(1, playerDamage);
                    opponentDamage = Math.max(1, opponentDamage);
                }
            }

            // Apply clinch control bonuses
            if (battleState.isClinched && battleState.playerHasControl && (playerAttack === 'knee' || playerAttack === 'elbow')) {
                playerDamage += 5; // +5 damage when controlling clinch using knee or elbow
            }
            if (battleState.isClinched && !battleState.playerHasControl && (opponentAttack === 'knee' || opponentAttack === 'elbow')) {
                opponentDamage += 5; // +5 damage when opponent controls clinch using knee or elbow
            }

            // Handle knockdown effects from sweep
            if (playerAttack === 'sweep') {
                opponentDamage += 1; // Sweep does 1 damage + knockdown
            }
            if (opponentAttack === 'sweep') {
                playerDamage += 1; // Sweep does 1 damage + knockdown
            }

            // Apply fighter specialty modifiers first
            let result = applyFighterSpecialties(
                playerAttack, opponentAttack, 
                playerDamage, opponentDamage, 
                playerHealthGain, opponentHealthGain,
                playerGainedBonus, opponentGainedBonus
            );

            // Apply rocked effects
            result = applyRockedEffects(
                playerAttack, opponentAttack,
                result.playerDamage, result.opponentDamage,
                result.playerHealthGain, result.opponentHealthGain
            );

            // Apply moral bonuses
            result = applyMoralBonuses(
                playerAttack, opponentAttack,
                result.playerDamage, result.opponentDamage,
                result.playerHealthGain, result.opponentHealthGain
            );

            // Update moral system
            updateMoralSystem(playerAttack, opponentAttack, result.opponentDamage, result.playerDamage);

            // Update rocked status and check for knockouts based on this exchange
            updateRockedStatus(playerAttack, opponentAttack, result.playerDamage, result.opponentDamage);

            // Override teep vs teep to always be 0 damage (after specialty bonuses are calculated)
            if (playerAttack === 'teep' && opponentAttack === 'teep') {
                result.playerDamage = 0;
                result.opponentDamage = 0;
            }

            return {
                playerDamage: result.opponentDamage, // Player takes opponent's damage
                opponentDamage: result.playerDamage, // Opponent takes player's damage
                playerHealthGain: result.playerHealthGain,
                opponentHealthGain: result.opponentHealthGain
            };
        }

        function isDefenseTechnique(attack) {
            return ['slip', 'roll', 'evade', 'check', 'parry'].includes(attack);
        }

        function isClinchTechnique(attack) {
            return ['full-plum', 'pummel', 'outside-bicep', 'sweep', 'escape'].includes(attack);
        }

        function updateMoralSystem(playerAttack, opponentAttack, playerDamage, opponentDamage) {
            // Award moral for attacks landed (1 moral per attack that deals damage)
            if (playerDamage > 0 && playerAttack !== 'block') {
                battleState.playerMoral += 1;
            }
            if (opponentDamage > 0 && opponentAttack !== 'block') {
                battleState.opponentMoral += 1;
            }
            
            // Award moral for exchanges won (2 moral per exchange won)
            if (playerDamage > opponentDamage && playerAttack !== 'block' && opponentAttack !== 'block') {
                battleState.playerMoral += 2;
            } else if (opponentDamage > playerDamage && playerAttack !== 'block' && opponentAttack !== 'block') {
                battleState.opponentMoral += 2;
            }
            
            // Handle knockdown moral loss
            if (battleState.playerKnockedDown) {
                battleState.playerMoral = Math.max(0, battleState.playerMoral - 2);
                battleState.playerKnockedDown = false; // Reset after processing
            }
            if (battleState.opponentKnockedDown) {
                battleState.opponentMoral = Math.max(0, battleState.opponentMoral - 2);
                battleState.opponentKnockedDown = false; // Reset after processing
            }
            
            // Cap moral at 100
            battleState.playerMoral = Math.min(100, battleState.playerMoral);
            battleState.opponentMoral = Math.min(100, battleState.opponentMoral);
        }

        function applyMoralBonuses(playerAttack, opponentAttack, playerDamage, opponentDamage, playerHealthGain, opponentHealthGain) {
            // Apply moral health bonuses (15+ moral = +2 health after every action)
            if (battleState.playerMoral >= 15) {
                playerHealthGain += 2;
            }
            if (battleState.opponentMoral >= 15) {
                opponentHealthGain += 2;
            }
            
            // Apply moral attack bonuses (50+ moral = +10 to successful attacks)
            if (battleState.playerMoral >= 50 && playerDamage > 0 && playerAttack !== 'block') {
                playerDamage += 10;
            }
            if (battleState.opponentMoral >= 50 && opponentDamage > 0 && opponentAttack !== 'block') {
                opponentDamage += 10;
            }
            
            // Check for moral knockout (100 moral = knockout with any successful attack)
            if (battleState.playerMoral >= 100 && playerDamage > 0 && playerAttack !== 'block') {
                battleState.flashKnockout = 'player-moral';
            }
            if (battleState.opponentMoral >= 100 && opponentDamage > 0 && opponentAttack !== 'block') {
                battleState.flashKnockout = 'opponent-moral';
            }
            
            return {
                playerDamage,
                opponentDamage,
                playerHealthGain,
                opponentHealthGain
            };
        }

        function handleClinchTransitions(playerAttack, opponentAttack) {
            // Handle escape breaking clinch FIRST (highest priority)
            if (playerAttack === 'escape' || opponentAttack === 'escape') {
                battleState.isClinched = false;
                battleState.playerHasControl = false;
                return; // Exit early - escape breaks all clinch states
            }
            
            // Handle sweep knocking opponent down (breaks clinch)
            if (playerAttack === 'sweep') {
                battleState.opponentKnockedDown = true;
                battleState.isClinched = false;
                battleState.playerHasControl = false;
                return; // Exit early - sweep breaks clinch
            } else if (opponentAttack === 'sweep') {
                battleState.playerKnockedDown = true;
                battleState.isClinched = false;
                battleState.playerHasControl = false;
                return; // Exit early - sweep breaks clinch
            }
            
            // Handle clinch initiation from neutral position
            if (!battleState.isClinched) {
                // Full plum and outside bicep initiate clinch with control
                if (playerAttack === 'full-plum' || playerAttack === 'outside-bicep') {
                    battleState.isClinched = true;
                    battleState.playerHasControl = true;
                    return;
                } else if (opponentAttack === 'full-plum' || opponentAttack === 'outside-bicep') {
                    battleState.isClinched = true;
                    battleState.playerHasControl = false;
                    return;
                }
                
                // Pummel from neutral initiates clinch with control
                if (playerAttack === 'pummel') {
                    battleState.isClinched = true;
                    battleState.playerHasControl = true;
                    return;
                } else if (opponentAttack === 'pummel') {
                    battleState.isClinched = true;
                    battleState.playerHasControl = false;
                    return;
                }
            } else {
                // Already in clinch - handle control switches
                
                // Handle pummel switching control (only works when already clinched)
                if (playerAttack === 'pummel' && !battleState.playerHasControl) {
                    battleState.playerHasControl = true; // Player takes control
                    return;
                } else if (opponentAttack === 'pummel' && battleState.playerHasControl) {
                    battleState.playerHasControl = false; // Opponent takes control
                    return;
                }
                
                // Handle angled knee control switching (only when not controlling)
                if (playerAttack === 'angled-knee' && !battleState.playerHasControl) {
                    battleState.playerHasControl = true; // Player reverses control
                    return;
                } else if (opponentAttack === 'angled-knee' && battleState.playerHasControl) {
                    battleState.playerHasControl = false; // Opponent reverses control
                    return;
                }
            }
        }

        function handleDefenseTechniques(playerAttack, opponentAttack) {
            let playerDamage = 0;
            let opponentDamage = 0;
            let playerHealthGain = 0;
            let opponentHealthGain = 0;

            // Handle player defense techniques
            if (playerAttack === 'slip') {
                if (opponentAttack === 'punch' || opponentAttack === 'elbow') {
                    // Successful slip - opponent punch/elbow loses power for rest of round
                    if (opponentAttack === 'punch') {
                        battleState.opponentSlipPunchReduction = 1;
                    } else {
                        battleState.opponentSlipElbowReduction = 1;
                    }
                    battleState.playerSlipNextAttackBonus = 2;
                    playerDamage = 0;
                    opponentDamage = 0;
                } else {
                    // Failed slip - take normal damage
                    playerDamage = attacks[opponentAttack].baseDamage;
                    opponentDamage = 0;
                }
            } else if (playerAttack === 'roll') {
                if (opponentAttack === 'punch' || opponentAttack === 'elbow') {
                    // Successful roll - opponent punch/elbow loses power for rest of round
                    if (opponentAttack === 'punch') {
                        battleState.opponentRollPunchReduction = 1;
                    } else {
                        battleState.opponentRollElbowReduction = 1;
                    }
                    battleState.playerRollNextAttackBonus = 2;
                    playerDamage = 0;
                    opponentDamage = 0;
                } else {
                    // Failed roll - take normal damage
                    playerDamage = attacks[opponentAttack].baseDamage;
                    opponentDamage = 0;
                }
            } else if (playerAttack === 'evade') {
                // Evade avoids all attacks but provides no counter bonus
                playerDamage = 0;
                opponentDamage = 0;
            } else if (playerAttack === 'check') {
                if (opponentAttack === 'kick' || opponentAttack === 'teep') {
                    // Successful check - counter kick attacks
                    playerDamage = 0;
                    opponentDamage = 2; // Counter damage
                } else {
                    // Failed check - take normal damage
                    playerDamage = attacks[opponentAttack].baseDamage;
                    opponentDamage = 0;
                }
            } else if (playerAttack === 'parry') {
                if (opponentAttack === 'punch' || opponentAttack === 'teep') {
                    // Successful parry - redirect attack, both take no damage
                    playerDamage = 0;
                    opponentDamage = 0;
                    battleState.playerParryNextAttackBonus = 3; // +3 to next punch or kick
                } else {
                    // Failed parry - take normal damage
                    playerDamage = attacks[opponentAttack].baseDamage;
                    opponentDamage = 0;
                }
            }

            // Handle opponent defense techniques (mirror logic)
            if (opponentAttack === 'slip') {
                if (playerAttack === 'punch' || playerAttack === 'elbow') {
                    if (playerAttack === 'punch') {
                        battleState.playerSlipPunchReduction = 1;
                    } else {
                        battleState.playerSlipElbowReduction = 1;
                    }
                    battleState.opponentSlipNextAttackBonus = 2;
                    playerDamage = 0;
                    opponentDamage = 0;
                } else if (!isDefenseTechnique(playerAttack)) {
                    opponentDamage = attacks[playerAttack].baseDamage;
                    playerDamage = 0;
                }
            } else if (opponentAttack === 'roll') {
                if (playerAttack === 'punch' || playerAttack === 'elbow') {
                    if (playerAttack === 'punch') {
                        battleState.playerRollPunchReduction = 1;
                    } else {
                        battleState.playerRollElbowReduction = 1;
                    }
                    battleState.opponentRollNextAttackBonus = 2;
                    playerDamage = 0;
                    opponentDamage = 0;
                } else if (!isDefenseTechnique(playerAttack)) {
                    opponentDamage = attacks[playerAttack].baseDamage;
                    playerDamage = 0;
                }
            } else if (opponentAttack === 'evade') {
                if (!isDefenseTechnique(playerAttack)) {
                    playerDamage = 0;
                    opponentDamage = 0;
                }
            } else if (opponentAttack === 'check') {
                if (playerAttack === 'kick' || playerAttack === 'teep') {
                    playerDamage = 2;
                    opponentDamage = 0;
                } else if (!isDefenseTechnique(playerAttack)) {
                    opponentDamage = attacks[playerAttack].baseDamage;
                    playerDamage = 0;
                }
            } else if (opponentAttack === 'parry') {
                if (playerAttack === 'punch' || playerAttack === 'teep') {
                    // Successful parry - redirect attack, both take no damage
                    playerDamage = 0;
                    opponentDamage = 0;
                    battleState.opponentParryNextAttackBonus = 3; // +3 to next punch or kick
                } else if (!isDefenseTechnique(playerAttack)) {
                    // Failed parry - take normal damage
                    opponentDamage = attacks[playerAttack].baseDamage;
                    playerDamage = 0;
                }
            }

            // Apply fighter specialty modifiers
            let result = applyFighterSpecialties(
                playerAttack, opponentAttack, 
                playerDamage, opponentDamage, 
                playerHealthGain, opponentHealthGain,
                false, false // No bonus mechanics for defense techniques
            );

            return {
                playerDamage: result.opponentDamage,
                opponentDamage: result.playerDamage,
                playerHealthGain: result.playerHealthGain,
                opponentHealthGain: result.opponentHealthGain
            };
        }

        function applyFighterSpecialties(playerAttack, opponentAttack, playerDamage, opponentDamage, playerHealthGain, opponentHealthGain, playerGainedBonus, opponentGainedBonus) {
            const playerFighter = battleState.playerFighter;
            const opponentFighter = battleState.opponentFighter;

            // Apply player specialty bonuses
            if (playerAttack !== 'block' && opponentAttack !== 'block') {
                // Dieselnoi - Knees specialty
                if (playerFighter === 'dieselnoi' && playerAttack === 'knee') {
                    playerDamage += 3;
                }
                // Buakaw - Kicks specialty  
                if (playerFighter === 'buakaw' && (playerAttack === 'kick' || playerAttack === 'teep')) {
                    playerDamage += 3;
                }
                // Samart - Punches specialty
                if (playerFighter === 'samart' && playerAttack === 'punch') {
                    playerDamage += 3;
                }
                // Namsaknoi - Elbows specialty
                if (playerFighter === 'namsaknoi' && playerAttack === 'elbow') {
                    playerDamage += 3;
                }
                // Saenchai - All-Around specialty
                if (playerFighter === 'saenchai') {
                    playerDamage += 1;
                }
                // Sagat - Power specialty (gains +10 when move would gain bonus)
                if (playerFighter === 'sagat' && playerGainedBonus) {
                    playerDamage += 10;
                }
                // Yodsanklai - Technique specialty (gains +8 when move would gain bonus, -2 when losing)
                if (playerFighter === 'yodsanklai') {
                    if (playerGainedBonus) {
                        playerDamage += 8;
                    } else if (checkOpponentWinsExchange(playerAttack, opponentAttack)) {
                        playerDamage = Math.max(1, playerDamage - 2);
                    }
                }
            }

            // Apply opponent specialty bonuses
            if (opponentAttack !== 'block' && playerAttack !== 'block') {
                // Dieselnoi - Knees specialty
                if (opponentFighter === 'dieselnoi' && opponentAttack === 'knee') {
                    opponentDamage += 3;
                }
                // Buakaw - Kicks specialty
                if (opponentFighter === 'buakaw' && (opponentAttack === 'kick' || opponentAttack === 'teep')) {
                    opponentDamage += 3;
                }
                // Samart - Punches specialty
                if (opponentFighter === 'samart' && opponentAttack === 'punch') {
                    opponentDamage += 3;
                }
                // Namsaknoi - Elbows specialty
                if (opponentFighter === 'namsaknoi' && opponentAttack === 'elbow') {
                    opponentDamage += 3;
                }
                // Saenchai - All-Around specialty
                if (opponentFighter === 'saenchai') {
                    opponentDamage += 1;
                }
                // Sagat - Power specialty (gains +10 when move would gain bonus)
                if (opponentFighter === 'sagat' && opponentGainedBonus) {
                    opponentDamage += 10;
                }
                // Yodsanklai - Technique specialty (gains +8 when move would gain bonus, -2 when losing)
                if (opponentFighter === 'yodsanklai') {
                    if (opponentGainedBonus) {
                        opponentDamage += 8;
                    } else if (checkPlayerWinsExchange(playerAttack, opponentAttack)) {
                        opponentDamage = Math.max(1, opponentDamage - 2);
                    }
                }
            }

            // Apply healing bonuses
            if (playerAttack === 'block' || (playerAttack === 'block' && opponentAttack === 'block')) {
                // Saenchai - All-Around specialty (+1 to heals)
                if (playerFighter === 'saenchai') {
                    playerHealthGain += 1;
                }
                // John Wayne Parr - Heart specialty (+10 to heals, +25 if both heal)
                if (playerFighter === 'johnwayne') {
                    if (playerAttack === 'block' && opponentAttack === 'block') {
                        playerHealthGain += 25; // +25 if both heal
                    } else {
                        playerHealthGain += 10; // +10 for regular heals
                    }
                }
                // Petchboonchu - Clinch specialty (+5 to all clinch attacks)
                if (playerFighter === 'petchboonchu' && isClinchTechnique(playerAttack)) {
                    playerDamage += 5;
                }
                if (playerFighter === 'petchboonchu' && (playerAttack === 'round-knee' || playerAttack === 'angled-knee' || playerAttack === 'knee-shield')) {
                    playerDamage += 5;
                }
            }

            if (opponentAttack === 'block' || (playerAttack === 'block' && opponentAttack === 'block')) {
                // Saenchai - All-Around specialty (+1 to heals)
                if (opponentFighter === 'saenchai') {
                    opponentHealthGain += 1;
                }
                // John Wayne Parr - Heart specialty (+10 to heals, +25 if both heal)
                if (opponentFighter === 'johnwayne') {
                    if (playerAttack === 'block' && opponentAttack === 'block') {
                        opponentHealthGain += 25; // +25 if both heal
                    } else {
                        opponentHealthGain += 10; // +10 for regular heals
                    }
                }
                // Petchboonchu - Clinch specialty (+5 to all clinch attacks)
                if (opponentFighter === 'petchboonchu' && isClinchTechnique(opponentAttack)) {
                    opponentDamage += 5;
                }
                if (opponentFighter === 'petchboonchu' && (opponentAttack === 'round-knee' || opponentAttack === 'angled-knee' || opponentAttack === 'knee-shield')) {
                    opponentDamage += 5;
                }
            }

            // Somrak - Speed specialty (all opponent attacks lose -2 power)
            if (playerFighter === 'somrak' && opponentAttack !== 'block') {
                opponentDamage = Math.max(1, opponentDamage - 2);
            }
            if (opponentFighter === 'somrak' && playerAttack !== 'block') {
                playerDamage = Math.max(1, playerDamage - 2);
            }

            return {
                playerDamage,
                opponentDamage,
                playerHealthGain,
                opponentHealthGain
            };
        }

        function selectFighter(fighterId) {
            battleState.playerFighter = fighterId;
            
            // Randomly select opponent (different from player)
            const availableOpponents = Object.keys(fighters).filter(id => id !== fighterId);
            battleState.opponentFighter = availableOpponents[Math.floor(Math.random() * availableOpponents.length)];
            
            startBattle();
        }

        function startBattle() {
            // Reset battle state
            battleState.playerHealth = 100;
            battleState.opponentHealth = 100;
            battleState.currentRound = 1;
            battleState.playerTurn = true;
            battleState.playerAction = null;
            battleState.opponentAction = null;
            battleState.gameActive = true;
            battleState.playerHasFirstMove = true;
            // Timer system removed - using attack-based rounds
            battleState.isRestPeriod = false;
            battleState.restTimer = 60;
            battleState.playerCornerChoice = null;
            battleState.opponentCornerChoice = null;
            battleState.waitingForCornerChoices = false;
            // Reset counters
            battleState.attackCount = 0;
            battleState.blockCount = 0;
            battleState.counterCount = 0;
            battleState.opponentAttackCount = 0;
            battleState.opponentBlockCount = 0;
            battleState.opponentCounterCount = 0;
            // Reset consecutive blocking
            battleState.playerConsecutiveBlocks = 0;
            battleState.opponentConsecutiveBlocks = 0;
            // Reset rocked status
            battleState.playerRockedRoundsLeft = 0;
            battleState.opponentRockedRoundsLeft = 0;
            battleState.playerConsecutiveWins = 0;
            battleState.opponentConsecutiveWins = 0;
            // Reset knockout states
            battleState.flashKnockout = null;
            battleState.consecutiveKnockout = null;
            // Reset special effects
            battleState.playerWaterStacks = 0;
            battleState.playerWaterAttacksLeft = 0;
            battleState.playerIceBlocksLeft = 0;
            battleState.playerEnswellPunchesLeft = 0;
            battleState.playerMotivationWinsLeft = 0;
            battleState.playerParryNextAttackBonus = 0;
            battleState.opponentWaterStacks = 0;
            battleState.opponentWaterAttacksLeft = 0;
            battleState.opponentIceBlocksLeft = 0;
            battleState.opponentEnswellPunchesLeft = 0;
            battleState.opponentMotivationWinsLeft = 0;
            battleState.opponentParryNextAttackBonus = 0;
            // Reset attack history
            battleState.playerLastAttack = null;
            battleState.opponentLastAttack = null;
            battleState.playerLastDamage = 0;
            battleState.opponentLastDamage = 0;
            // Reset clinch state
            battleState.isClinched = false;
            battleState.playerHasControl = false;
            // Reset moral system
            battleState.playerMoral = 0;
            battleState.opponentMoral = 0;
            battleState.playerKnockedDown = false;
            battleState.opponentKnockedDown = false;

            // Hide fighter selection, show battle screen
            document.getElementById('fighter-selection').style.display = 'none';
            document.getElementById('battle-screen').style.display = 'block';
            document.getElementById('corner-break').style.display = 'none';

            // Update fighter displays
            const playerFighter = fighters[battleState.playerFighter];
            const opponentFighter = fighters[battleState.opponentFighter];

            document.getElementById('player-fighter-name').textContent = playerFighter.name;
            document.getElementById('player-avatar').innerHTML = playerFighter.avatar;
            document.getElementById('opponent-fighter-name').textContent = opponentFighter.name;
            document.getElementById('opponent-avatar').innerHTML = opponentFighter.avatar;

            updateHealthBars();
            updateRoundDisplay();
            updateCounterDisplay();
            updateAttackHistory();
            updateClinchDisplay();
            updateActionDisplay('Choose your attack!');
            showTacticalMenu();
            enableAttackButtons();
        }

        function selectAttack(attackType) {
            if (!battleState.gameActive || !battleState.playerTurn) return;

            battleState.playerAction = attackType;
            battleState.playerTurn = false;

            // Disable attack buttons
            disableAttackButtons();

            // Generate opponent action based on clinch state
            let attackTypes;
            if (battleState.isClinched && battleState.playerHasControl) {
                // Opponent is clinched but not in control - limited to clinch options
                attackTypes = ['round-knee', 'angled-knee', 'knee-shield', 'elbow', 'escape'];
            } else {
                // Normal attack options (including when opponent controls clinch)
                attackTypes = ['punch', 'kick', 'elbow', 'knee', 'teep', 'block', 'full-plum', 'pummel', 'outside-bicep', 'sweep', 'escape'];
            }
            battleState.opponentAction = attackTypes[Math.floor(Math.random() * attackTypes.length)];

            // Process round
            setTimeout(() => {
                processRound();
            }, 1000);
        }

        function opponentTurn() {
            if (!battleState.gameActive) return;

            // Generate opponent action based on clinch state
            let attackTypes;
            if (battleState.isClinched && battleState.playerHasControl) {
                // Opponent is clinched but not in control - limited to clinch options
                attackTypes = ['round-knee', 'angled-knee', 'knee-shield', 'elbow', 'escape'];
            } else {
                // Normal attack options (including when opponent controls clinch)
                attackTypes = ['punch', 'kick', 'elbow', 'knee', 'teep', 'block', 'full-plum', 'pummel', 'outside-bicep', 'sweep', 'escape'];
            }
            battleState.opponentAction = attackTypes[Math.floor(Math.random() * attackTypes.length)];

            updateActionDisplay('Opponent attacks! Your turn to respond...');
            
            // Now it's player's turn to respond
            battleState.playerTurn = true;
            enableAttackButtons();
        }

        function processRound() {
            const playerAttack = attacks[battleState.playerAction];
            const opponentAttack = attacks[battleState.opponentAction];

            let actionText = `You used ${playerAttack.name} ${playerAttack.emoji} vs ${opponentAttack.name} ${opponentAttack.emoji}! `;

            // Update counters based on player action
            if (battleState.playerAction === 'block') {
                battleState.blockCount++;
                battleState.totalBlockCount++;
            } else {
                battleState.attackCount++;
                battleState.totalAttackCount++;
            }

            // Update counters based on opponent action
            if (battleState.opponentAction === 'block') {
                battleState.opponentBlockCount++;
                battleState.totalOpponentBlockCount++;
            } else {
                battleState.opponentAttackCount++;
                battleState.totalOpponentAttackCount++;
            }

            // Check for exchanges won AFTER damage calculation
            // This will be done after we get the damage results

            // Increment attacks in current round
            battleState.attacksInCurrentRound++;

            // Calculate damage and health changes
            const result = calculateDamage(battleState.playerAction, battleState.opponentAction);

            // Store attack history before applying damage
            battleState.playerLastAttack = battleState.playerAction;
            battleState.opponentLastAttack = battleState.opponentAction;
            battleState.playerLastDamage = result.opponentDamage; // Damage player dealt to opponent
            battleState.opponentLastDamage = result.playerDamage; // Damage opponent dealt to player

            // Check for exchanges won based on damage dealt (before applying damage)
            if (battleState.playerAction !== 'block' && battleState.opponentAction !== 'block') {
                if (result.opponentDamage > result.playerDamage) {
                    // Player won the exchange (dealt more damage to opponent)
                    battleState.counterCount++;
                    battleState.totalCounterCount++;
                } else if (result.playerDamage > result.opponentDamage) {
                    // Opponent won the exchange (dealt more damage to player)
                    battleState.opponentCounterCount++;
                    battleState.totalOpponentCounterCount++;
                }
                // If damage is equal, no one wins the exchange
            }

            // Apply damage and health gains
            battleState.playerHealth = Math.max(0, battleState.playerHealth - result.playerDamage);
            battleState.opponentHealth = Math.max(0, battleState.opponentHealth - result.opponentDamage);

            // Apply health gains (capped at 100)
            battleState.playerHealth = Math.min(100, battleState.playerHealth + result.playerHealthGain);
            battleState.opponentHealth = Math.min(100, battleState.opponentHealth + result.opponentHealthGain);

            // Create detailed action text
            if (battleState.playerAction === 'block' && battleState.opponentAction === 'block') {
                actionText += `Both fighters blocked! You recovered ${result.playerHealthGain} health, opponent recovered ${result.opponentHealthGain} health.`;
                battleState.playerHasFirstMove = Math.random() < 0.5; // Random first move
            } else if (battleState.playerAction === 'block') {
                actionText += `You blocked and recovered ${result.playerHealthGain} health! You get first move next round.`;
                battleState.playerHasFirstMove = true;
            } else if (battleState.opponentAction === 'block') {
                actionText += `Opponent blocked and recovered ${result.opponentHealthGain} health! They get first move next round.`;
                battleState.playerHasFirstMove = false;
            } else {
                if (result.playerDamage > 0 && result.opponentDamage > 0) {
                    actionText += `You dealt ${result.opponentDamage} damage and took ${result.playerDamage} damage!`;
                } else if (result.opponentDamage > 0) {
                    actionText += `You dealt ${result.opponentDamage} damage!`;
                } else if (result.playerDamage > 0) {
                    actionText += `You took ${result.playerDamage} damage!`;
                }
            }

            // Add clinch state notifications
            if (battleState.isClinched && battleState.playerHasControl) {
                actionText += ` 🤼 YOU CONTROL THE CLINCH! (+5 damage with knees/elbows)`;
            } else if (battleState.isClinched && !battleState.playerHasControl) {
                actionText += ` 🤼 OPPONENT CONTROLS THE CLINCH! (They get +5 damage with knees/elbows)`;
            } else if (!battleState.isClinched && (battleState.playerLastAttack === 'escape' || battleState.opponentLastAttack === 'escape')) {
                actionText += ` 🏃 ESCAPED FROM CLINCH!`;
            } else if (battleState.isClinched && (battleState.playerLastAttack === 'pummel' || battleState.opponentLastAttack === 'pummel' || battleState.playerLastAttack === 'angled-knee' || battleState.opponentLastAttack === 'angled-knee')) {
                actionText += ` 🔄 CLINCH CONTROL REVERSED!`;
            }

            // Add rocked status notifications
            if (battleState.opponentRockedRoundsLeft === 2) {
                actionText += ` 💫 OPPONENT IS ROCKED! (-2 damage, -1 heal, +2 damage taken for 2 rounds)`;
            } else if (battleState.playerRockedRoundsLeft === 2) {
                actionText += ` 💫 YOU ARE ROCKED! (-2 damage, -1 heal, +2 damage taken for 2 rounds)`;
            }
            
            // Add rocked status countdown
            if (battleState.opponentRockedRoundsLeft === 1) {
                actionText += ` 💫 Opponent rocked (1 round left)`;
            } else if (battleState.playerRockedRoundsLeft === 1) {
                actionText += ` 💫 You are rocked (1 round left)`;
            }

            updateActionDisplay(actionText);
            updateHealthBars();
            updateCounterDisplay();
            updateAttackHistory();
            updateClinchDisplay();
            updateRoundDisplay();

            // Check for flash knockout first
            if (battleState.flashKnockout) {
                setTimeout(() => {
                    handleFlashKnockout();
                }, 2000);
                return;
            }

            // Check for consecutive knockout
            if (battleState.consecutiveKnockout) {
                setTimeout(() => {
                    handleConsecutiveKnockout();
                }, 2000);
                return;
            }

            // Check for health knockout
            if (battleState.playerHealth <= 0 || battleState.opponentHealth <= 0) {
                setTimeout(() => {
                    endBattle();
                }, 2000);
                return;
            }

            // Check if round is complete (10 attacks from each fighter = 20 total)
            if (battleState.attacksInCurrentRound >= battleState.maxAttacksPerRound * 2) {
                setTimeout(() => {
                    endRound();
                }, 2000);
                return;
            }

            // Countdown rocked status
            if (battleState.playerRockedRoundsLeft > 0) {
                battleState.playerRockedRoundsLeft--;
            }
            if (battleState.opponentRockedRoundsLeft > 0) {
                battleState.opponentRockedRoundsLeft--;
            }

            // Next exchange
            setTimeout(() => {
                nextExchange();
            }, 3000);
        }

        function nextExchange() {
            battleState.playerTurn = battleState.playerHasFirstMove;
            battleState.playerAction = null;
            battleState.opponentAction = null;
            
            // Always enable buttons and set proper turn state for next exchange
            if (battleState.playerHasFirstMove) {
                updateActionDisplay('Choose your attack!');
                showTacticalMenu();
                enableAttackButtons();
            } else {
                updateActionDisplay('Opponent\'s turn...');
                disableAttackButtons();
                // Opponent makes their move
                setTimeout(() => {
                    opponentTurn();
                }, 1500);
            }
        }

        function endRound() {
            // Store round health scores for judging
            battleState.roundHealthScores.push({
                playerHealth: battleState.playerHealth,
                opponentHealth: battleState.opponentHealth,
                playerAttacks: battleState.attackCount,
                opponentAttacks: battleState.opponentAttackCount,
                playerCounters: battleState.counterCount,
                opponentCounters: battleState.opponentCounterCount
            });

            // Check if fight is complete
            if (battleState.currentRound >= battleState.maxRounds) {
                setTimeout(() => {
                    endFight();
                }, 2000);
                return;
            }

            // Start rest period between rounds
            battleState.isRestPeriod = true;
            battleState.restTimer = 60;
            battleState.playerCornerChoice = null;
            battleState.opponentCornerChoice = null;
            battleState.waitingForCornerChoices = true;

            showCornerBreak();
            startRestTimer();
        }

        function startNextRound() {
            battleState.currentRound++;
            battleState.attacksInCurrentRound = 0;
            battleState.isRestPeriod = false;
            
            // Reset round counters
            battleState.attackCount = 0;
            battleState.blockCount = 0;
            battleState.counterCount = 0;
            battleState.opponentAttackCount = 0;
            battleState.opponentBlockCount = 0;
            battleState.opponentCounterCount = 0;

            // Reset defense effects at start of new round
            battleState.playerSlipPunchReduction = 0;
            battleState.playerSlipElbowReduction = 0;
            battleState.playerRollPunchReduction = 0;
            battleState.playerRollElbowReduction = 0;
            battleState.playerParryNextAttackBonus = 0;
            battleState.opponentSlipPunchReduction = 0;
            battleState.opponentSlipElbowReduction = 0;
            battleState.opponentRollPunchReduction = 0;
            battleState.opponentRollElbowReduction = 0;
            battleState.opponentParryNextAttackBonus = 0;
            // Reset clinch state
            battleState.isClinched = false;
            battleState.playerHasControl = false;
            // Reset moral system
            battleState.playerMoral = 0;
            battleState.opponentMoral = 0;
            battleState.playerKnockedDown = false;
            battleState.opponentKnockedDown = false;

            hideCornerBreak();
            updateRoundDisplay();
            updateCounterDisplay();
            updateActionDisplay('New round begins! Choose your attack!');
            enableAttackButtons();
        }



        function startRestTimer() {
            const restInterval = setInterval(() => {
                battleState.restTimer--;
                document.getElementById('rest-timer-value').textContent = battleState.restTimer;

                if (battleState.restTimer <= 0) {
                    clearInterval(restInterval);
                    endRestPeriod();
                }
            }, 1000);
        }

        function endRestPeriod() {
            startNextRound();
        }

        function endFight() {
            battleState.gameActive = false;
            
            // Calculate judges decision
            const judgesDecision = calculateJudgesDecision();
            showFightResult(judgesDecision);
        }

        function calculateJudgesDecision() {
            let playerScore = 0;
            let opponentScore = 0;
            
            // Health scoring (40% weight)
            const healthDifference = battleState.playerHealth - battleState.opponentHealth;
            if (healthDifference > 0) {
                playerScore += 40;
            } else if (healthDifference < 0) {
                opponentScore += 40;
            } else {
                playerScore += 20;
                opponentScore += 20;
            }
            
            // Attacks landed scoring (35% weight)
            const attackDifference = battleState.totalAttackCount - battleState.totalOpponentAttackCount;
            if (attackDifference > 0) {
                playerScore += 35;
            } else if (attackDifference < 0) {
                opponentScore += 35;
            } else {
                playerScore += 17.5;
                opponentScore += 17.5;
            }
            
            // Exchanges won scoring (25% weight - tiebreaker)
            const counterDifference = battleState.totalCounterCount - battleState.totalOpponentCounterCount;
            if (counterDifference > 0) {
                playerScore += 25;
            } else if (counterDifference < 0) {
                opponentScore += 25;
            } else {
                playerScore += 12.5;
                opponentScore += 12.5;
            }
            
            // Determine winner
            let winner, playerWon, isDraw;
            if (playerScore > opponentScore) {
                winner = battleState.isCareerMode ? careerState.fighterName : fighters[battleState.playerFighter].name;
                playerWon = true;
                isDraw = false;
            } else if (opponentScore > playerScore) {
                winner = fighters[battleState.opponentFighter].name;
                playerWon = false;
                isDraw = false;
            } else {
                winner = 'Draw';
                playerWon = false;
                isDraw = true;
            }
            
            // Update career record if in career mode
            if (battleState.isCareerMode) {
                updateCareerRecord(playerWon, isDraw);
            }
            
            return {
                winner,
                playerScore: Math.round(playerScore),
                opponentScore: Math.round(opponentScore),
                playerHealth: battleState.playerHealth,
                opponentHealth: battleState.opponentHealth,
                playerAttacks: battleState.totalAttackCount,
                opponentAttacks: battleState.totalOpponentAttackCount,
                playerCounters: battleState.totalCounterCount,
                opponentCounters: battleState.totalOpponentCounterCount
            };
        }

        function showFightResult(judgesDecision) {
            let resultText = '';
            
            if (judgesDecision.winner === 'Draw') {
                resultText = `🤝 JUDGES DECISION: DRAW! (${judgesDecision.playerScore}-${judgesDecision.opponentScore}) `;
            } else {
                resultText = `🏆 JUDGES DECISION: ${judgesDecision.winner.toUpperCase()} WINS! (${judgesDecision.playerScore}-${judgesDecision.opponentScore}) `;
            }
            
            resultText += `📊 Final Stats: `;
            resultText += `Health: You ${judgesDecision.playerHealth} - ${judgesDecision.opponentHealth} Opponent | `;
            resultText += `Attacks: You ${judgesDecision.playerAttacks} - ${judgesDecision.opponentAttacks} Opponent | `;
            resultText += `Exchanges Won: You ${judgesDecision.playerCounters} - ${judgesDecision.opponentCounters} Opponent`;

            updateActionDisplay(resultText);
            disableAttackButtons();
            hideCornerBreak();
            
            // Show victory popup
            showVictoryPopup(judgesDecision.winner, 'Judges Decision');
        }

        function judgeDecision() {
            // This function is now only called for sudden death scenarios
            // Regular fight endings are handled by endFight()
            let result = '';
            if (battleState.playerHealth > battleState.opponentHealth) {
                result = '🏆 SUDDEN DEATH WINNER: YOU WIN! Superior health advantage!';
            } else if (battleState.opponentHealth > battleState.playerHealth) {
                result = '😤 SUDDEN DEATH WINNER: YOU LOSE! Opponent had more health!';
            } else {
                result = '🤝 SUDDEN DEATH DRAW! Incredible fight!';
            }

            battleState.gameActive = false;
            updateActionDisplay(result);
            disableAttackButtons();
        }

        function handleFlashKnockout() {
            battleState.gameActive = false;
            let result = '';
            let winner = '';
            let method = '';

            if (battleState.flashKnockout === 'player') {
                result = '⚡💥 FLASH KNOCKOUT! Incredible! You landed a perfect strike that ended the fight instantly!';
                winner = battleState.isCareerMode ? careerState.fighterName : fighters[battleState.playerFighter].name;
                method = 'Flash Knockout';
                // Update career record if in career mode
                if (battleState.isCareerMode) {
                    updateCareerRecord(true, false);
                }
            } else if (battleState.flashKnockout === 'player-moral') {
                result = '💯⚡ MORAL KNOCKOUT! Your fighting spirit reached 100! You dominated with an unstoppable attack!';
                winner = battleState.isCareerMode ? careerState.fighterName : fighters[battleState.playerFighter].name;
                method = 'Moral Knockout';
                // Update career record if in career mode
                if (battleState.isCareerMode) {
                    updateCareerRecord(true, false);
                }
            } else if (battleState.flashKnockout === 'opponent-moral') {
                result = '💯⚡ MORAL KNOCKOUT! Your opponent\'s fighting spirit reached 100! They dominated with an unstoppable attack!';
                winner = fighters[battleState.opponentFighter].name;
                method = 'Moral Knockout';
                // Update career record if in career mode
                if (battleState.isCareerMode) {
                    updateCareerRecord(false, false);
                }
            } else {
                result = '⚡💥 FLASH KNOCKOUT! Your opponent landed a devastating strike that ended the fight instantly!';
                winner = fighters[battleState.opponentFighter].name;
                method = 'Flash Knockout';
                // Update career record if in career mode
                if (battleState.isCareerMode) {
                    updateCareerRecord(false, false);
                }
            }

            updateActionDisplay(result);
            disableAttackButtons();
            hideCornerBreak();
            
            // Show victory popup
            showVictoryPopup(winner, method);
        }

        function handleConsecutiveKnockout() {
            battleState.gameActive = false;
            let result = '';
            let winner = '';

            if (battleState.consecutiveKnockout === 'player') {
                result = '🔥💥 TECHNICAL KNOCKOUT! You dominated with 4 consecutive winning exchanges! Referee stops the fight!';
                winner = battleState.isCareerMode ? careerState.fighterName : fighters[battleState.playerFighter].name;
                // Update career record if in career mode
                if (battleState.isCareerMode) {
                    updateCareerRecord(true, false);
                }
            } else {
                result = '🔥💥 TECHNICAL KNOCKOUT! Your opponent dominated with 4 consecutive winning exchanges! Referee stops the fight!';
                winner = fighters[battleState.opponentFighter].name;
                // Update career record if in career mode
                if (battleState.isCareerMode) {
                    updateCareerRecord(false, false);
                }
            }

            updateActionDisplay(result);
            disableAttackButtons();
            hideCornerBreak();
            
            // Show victory popup
            showVictoryPopup(winner, 'Technical Knockout');
        }

        function endBattle() {
            battleState.gameActive = false;
            let result = '';
            let playerWon = false;
            let winner = '';

            if (battleState.playerHealth <= 0) {
                result = '💀 KNOCKOUT! You have been defeated!';
                playerWon = false;
                winner = fighters[battleState.opponentFighter].name;
            } else {
                result = '🥊 KNOCKOUT! You are victorious!';
                playerWon = true;
                winner = battleState.isCareerMode ? careerState.fighterName : fighters[battleState.playerFighter].name;
            }

            // Update career record if in career mode
            if (battleState.isCareerMode) {
                updateCareerRecord(playerWon, false);
            }

            updateActionDisplay(result);
            disableAttackButtons();
            hideCornerBreak();
            
            // Show victory popup
            showVictoryPopup(winner, 'Knockout');
        }

        function updateHealthBars() {
            const playerHealthPercent = (battleState.playerHealth / 100) * 100;
            const opponentHealthPercent = (battleState.opponentHealth / 100) * 100;

            const playerBar = document.getElementById('player-health-bar');
            const opponentBar = document.getElementById('opponent-health-bar');

            playerBar.style.width = playerHealthPercent + '%';
            opponentBar.style.width = opponentHealthPercent + '%';

            // Update health bar colors
            if (playerHealthPercent <= 20) {
                playerBar.className = 'health-bar-fill critical';
            } else if (playerHealthPercent <= 40) {
                playerBar.className = 'health-bar-fill low';
            } else {
                playerBar.className = 'health-bar-fill';
            }

            if (opponentHealthPercent <= 20) {
                opponentBar.className = 'health-bar-fill critical';
            } else if (opponentHealthPercent <= 40) {
                opponentBar.className = 'health-bar-fill low';
            } else {
                opponentBar.className = 'health-bar-fill';
            }

            document.getElementById('player-health').textContent = battleState.playerHealth;
            document.getElementById('opponent-health').textContent = battleState.opponentHealth;
        }

        function selectCornerChoice(choice) {
            if (!battleState.waitingForCornerChoices) return;

            battleState.playerCornerChoice = choice;
            
            // Generate opponent choice
            const choices = ['water', 'ice', 'enswell', 'motivate'];
            battleState.opponentCornerChoice = choices[Math.floor(Math.random() * choices.length)];

            // Disable corner buttons
            const cornerButtons = document.querySelectorAll('.corner-btn');
            cornerButtons.forEach(btn => btn.disabled = true);

            // Process corner choices
            processCornerChoices();
        }

        function processCornerChoices() {
            const playerChoice = battleState.playerCornerChoice;
            const opponentChoice = battleState.opponentCornerChoice;

            let statusText = `You chose ${getCornerChoiceName(playerChoice)} vs opponent's ${getCornerChoiceName(opponentChoice)}. `;

            // Apply player corner effects
            let playerHealAmount = 5; // Base +5 health for corner break
            let playerEffectDescription = '';

            switch(playerChoice) {
                case 'water':
                    playerHealAmount += 3; // +5 base + 3 water = 8 total
                    battleState.playerWaterStacks += battleState.currentRound;
                    battleState.playerWaterAttacksLeft = 3;
                    playerEffectDescription = `+${playerHealAmount} HP, +${battleState.playerWaterStacks} to next 3 attacks`;
                    break;
                case 'ice':
                    battleState.playerIceBlocksLeft = 1;
                    playerEffectDescription = `+${playerHealAmount} HP, +3 to next block`;
                    break;
                case 'enswell':
                    battleState.playerEnswellPunchesLeft = 1;
                    playerEffectDescription = `+${playerHealAmount} HP, -3 to next opponent punch`;
                    break;
                case 'motivate':
                    battleState.playerMotivationWinsLeft = 1;
                    playerEffectDescription = `+${playerHealAmount} HP, +10 to next winning exchange`;
                    break;
            }

            // Apply opponent corner effects
            let opponentHealAmount = 5; // Base +5 health for corner break
            let opponentEffectDescription = '';

            switch(opponentChoice) {
                case 'water':
                    opponentHealAmount += 3; // +5 base + 3 water = 8 total
                    battleState.opponentWaterStacks += battleState.currentRound;
                    battleState.opponentWaterAttacksLeft = 3;
                    opponentEffectDescription = `+${opponentHealAmount} HP, +${battleState.opponentWaterStacks} to next 3 attacks`;
                    break;
                case 'ice':
                    battleState.opponentIceBlocksLeft = 1;
                    opponentEffectDescription = `+${opponentHealAmount} HP, +3 to next block`;
                    break;
                case 'enswell':
                    battleState.opponentEnswellPunchesLeft = 1;
                    opponentEffectDescription = `+${opponentHealAmount} HP, -3 to next player punch`;
                    break;
                case 'motivate':
                    battleState.opponentMotivationWinsLeft = 1;
                    opponentEffectDescription = `+${opponentHealAmount} HP, +10 to next winning exchange`;
                    break;
            }

            // Apply fighter specialty bonuses for healing
            const playerFighter = battleState.isCareerMode ? careerState.fighterSpecialty : battleState.playerFighter;
            const opponentFighter = battleState.opponentFighter;
            
            if (playerFighter === 'saenchai' && playerHealAmount > 0) {
                playerHealAmount += 1;
            }
            if (playerFighter === 'johnwayne' && playerHealAmount > 0) {
                playerHealAmount += 10;
            }
            
            if (opponentFighter === 'saenchai' && opponentHealAmount > 0) {
                opponentHealAmount += 1;
            }
            if (opponentFighter === 'johnwayne' && opponentHealAmount > 0) {
                opponentHealAmount += 10;
            }

            // Apply healing
            if (playerHealAmount > 0) {
                battleState.playerHealth = Math.min(100, battleState.playerHealth + playerHealAmount);
            }
            if (opponentHealAmount > 0) {
                battleState.opponentHealth = Math.min(100, battleState.opponentHealth + opponentHealAmount);
            }
            updateHealthBars();

            statusText += `Your effect: ${playerEffectDescription}. Opponent effect: ${opponentEffectDescription}.`;

            document.getElementById('corner-status').textContent = statusText;
            battleState.waitingForCornerChoices = false;
        }

        function getCornerChoiceName(choice) {
            const names = {
                water: 'Water 💧',
                ice: 'Ice Pack 🧊',
                enswell: 'Enswell 🔧',
                motivate: 'Motivate 💪'
            };
            return names[choice] || choice;
        }

        function showCornerBreak() {
            document.getElementById('battle-arena').style.display = 'none';
            document.getElementById('attack-buttons').style.display = 'none';
            document.getElementById('corner-break').style.display = 'block';

            // Reset corner buttons
            const cornerButtons = document.querySelectorAll('.corner-btn');
            cornerButtons.forEach(btn => btn.disabled = false);

            document.getElementById('corner-status').textContent = 'Make your choice...';
            document.getElementById('rest-timer-value').textContent = battleState.restTimer;
        }

        function hideCornerBreak() {
            document.getElementById('corner-break').style.display = 'none';
            document.getElementById('battle-arena').style.display = 'block';
            document.getElementById('attack-buttons').style.display = 'grid';
        }

        function showTimer() {
            // Legacy function - now using timer popup
            showTimerPopup();
        }

        function hideTimer() {
            // Legacy function - now using timer popup
            hideTimerPopup();
        }

        function updateTimerDisplay() {
            // Legacy function - now using timer popup
            updateTimerPopupDisplay();
        }

        function updateRoundDisplay() {
            document.getElementById('current-round').textContent = battleState.currentRound;
            document.getElementById('max-rounds').textContent = battleState.maxRounds;
            document.getElementById('attacks-in-round').textContent = battleState.attacksInCurrentRound;
            document.getElementById('max-attacks-per-round').textContent = battleState.maxAttacksPerRound * 2;
            const turnText = battleState.playerTurn ? 'Your Turn' : 'Opponent\'s Turn';
            document.getElementById('turn-indicator').textContent = turnText;
        }

        function updateActionDisplay(text) {
            document.getElementById('action-text').textContent = text;
        }

        function updateCounterDisplay() {
            document.getElementById('attack-counter').textContent = battleState.attackCount;
            document.getElementById('block-counter').textContent = battleState.blockCount;
            document.getElementById('counter-counter').textContent = battleState.counterCount;
            document.getElementById('opponent-attack-counter').textContent = battleState.opponentAttackCount;
            document.getElementById('opponent-block-counter').textContent = battleState.opponentBlockCount;
            document.getElementById('opponent-counter-counter').textContent = battleState.opponentCounterCount;
            
            // Update moral displays with color coding
            const playerMoralElement = document.getElementById('player-moral');
            const opponentMoralElement = document.getElementById('opponent-moral');
            
            playerMoralElement.textContent = battleState.playerMoral;
            opponentMoralElement.textContent = battleState.opponentMoral;
            
            // Color code moral based on thresholds
            if (battleState.playerMoral >= 100) {
                playerMoralElement.style.background = 'linear-gradient(135deg, #d63031, #e17055)';
                playerMoralElement.style.color = 'white';
            } else if (battleState.playerMoral >= 50) {
                playerMoralElement.style.background = 'linear-gradient(135deg, #fd79a8, #fdcb6e)';
                playerMoralElement.style.color = 'white';
            } else if (battleState.playerMoral >= 15) {
                playerMoralElement.style.background = 'linear-gradient(135deg, #00b894, #55a3ff)';
                playerMoralElement.style.color = 'white';
            } else {
                playerMoralElement.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                playerMoralElement.style.color = 'white';
            }
            
            if (battleState.opponentMoral >= 100) {
                opponentMoralElement.style.background = 'linear-gradient(135deg, #d63031, #e17055)';
                opponentMoralElement.style.color = 'white';
            } else if (battleState.opponentMoral >= 50) {
                opponentMoralElement.style.background = 'linear-gradient(135deg, #fd79a8, #fdcb6e)';
                opponentMoralElement.style.color = 'white';
            } else if (battleState.opponentMoral >= 15) {
                opponentMoralElement.style.background = 'linear-gradient(135deg, #00b894, #55a3ff)';
                opponentMoralElement.style.color = 'white';
            } else {
                opponentMoralElement.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                opponentMoralElement.style.color = 'white';
            }
        }

        function updateAttackHistory() {
            // Update player attack history
            if (battleState.playerLastAttack) {
                const playerAttack = attacks[battleState.playerLastAttack];
                document.getElementById('player-last-attack-icon').textContent = playerAttack.emoji;
                document.getElementById('player-last-attack-name').textContent = playerAttack.name;
                
                if (battleState.playerLastAttack === 'block' || battleState.playerLastAttack === 'knee-shield') {
                    // For blocks and knee shields, show health gained instead of damage
                    const healthGained = battleState.playerLastDamage || 0; // This would be health gained for blocks
                    document.getElementById('player-last-attack-power').textContent = `+${Math.abs(healthGained)} HP`;
                } else {
                    document.getElementById('player-last-attack-power').textContent = `${battleState.playerLastDamage} DMG`;
                }
            } else {
                document.getElementById('player-last-attack-icon').textContent = '⚔️';
                document.getElementById('player-last-attack-name').textContent = 'Ready to Fight';
                document.getElementById('player-last-attack-power').textContent = '0 DMG';
            }

            // Update opponent attack history
            if (battleState.opponentLastAttack) {
                const opponentAttack = attacks[battleState.opponentLastAttack];
                document.getElementById('opponent-last-attack-icon').textContent = opponentAttack.emoji;
                document.getElementById('opponent-last-attack-name').textContent = opponentAttack.name;
                
                if (battleState.opponentLastAttack === 'block' || battleState.opponentLastAttack === 'knee-shield') {
                    // For blocks and knee shields, show health gained instead of damage
                    const healthGained = battleState.opponentLastDamage || 0; // This would be health gained for blocks
                    document.getElementById('opponent-last-attack-power').textContent = `+${Math.abs(healthGained)} HP`;
                } else {
                    document.getElementById('opponent-last-attack-power').textContent = `${battleState.opponentLastDamage} DMG`;
                }
            } else {
                document.getElementById('opponent-last-attack-icon').textContent = '⚔️';
                document.getElementById('opponent-last-attack-name').textContent = 'Ready to Fight';
                document.getElementById('opponent-last-attack-power').textContent = '0 DMG';
            }
        }

        function updateClinchDisplay() {
            const clinchCircle = document.getElementById('clinch-status-circle');
            const clinchLabel = document.getElementById('clinch-status-label');
            
            // Remove all status classes
            clinchCircle.classList.remove('distance', 'clinching', 'clinched');
            
            if (battleState.isClinched) {
                if (battleState.playerHasControl) {
                    // Player controls clinch - green "clinching"
                    clinchCircle.classList.add('clinching');
                    clinchCircle.textContent = '🤼';
                    clinchLabel.textContent = 'Clinching';
                } else {
                    // Opponent controls clinch - red "clinched"
                    clinchCircle.classList.add('clinched');
                    clinchCircle.textContent = '🔒';
                    clinchLabel.textContent = 'Clinched';
                }
            } else {
                // No clinch - blue "distance fighting"
                clinchCircle.classList.add('distance');
                clinchCircle.textContent = '📏';
                clinchLabel.textContent = 'Distance';
            }
        }

        function checkPlayerWinsExchange(playerAttack, opponentAttack) {
            // Returns true if player wins the rock-paper-scissors exchange
            if (playerAttack === 'punch' && opponentAttack === 'kick') return true;
            if (playerAttack === 'elbow' && opponentAttack === 'punch') return true;
            if (playerAttack === 'knee' && opponentAttack === 'elbow') return true;
            if (playerAttack === 'kick' && opponentAttack === 'knee') return true;
            if (playerAttack === 'teep' && opponentAttack === 'kick') return true;
            return false;
        }

        function checkOpponentWinsExchange(playerAttack, opponentAttack) {
            // Returns true if opponent wins the rock-paper-scissors exchange
            if (opponentAttack === 'punch' && playerAttack === 'kick') return true;
            if (opponentAttack === 'elbow' && playerAttack === 'punch') return true;
            if (opponentAttack === 'knee' && playerAttack === 'elbow') return true;
            if (opponentAttack === 'kick' && playerAttack === 'knee') return true;
            if (opponentAttack === 'teep' && playerAttack === 'kick') return true;
            return false;
        }

        function updateRockedStatus(playerAttack, opponentAttack, playerDamage, opponentDamage) {
            // Determine who won this exchange (if anyone)
            let playerWonExchange = false;
            let opponentWonExchange = false;
            
            // Skip if either fighter blocked
            if (playerAttack === 'block' || opponentAttack === 'block') {
                // Reset consecutive wins when blocking
                battleState.playerConsecutiveWins = 0;
                battleState.opponentConsecutiveWins = 0;
                return;
            }
            
            // Check who dealt more damage (wins the exchange)
            // Note: playerDamage is damage TO player, opponentDamage is damage TO opponent
            if (opponentDamage > playerDamage) {
                // Player won (dealt more damage to opponent than received)
                playerWonExchange = true;
                battleState.playerConsecutiveWins++;
                battleState.opponentConsecutiveWins = 0;
            } else if (playerDamage > opponentDamage) {
                // Opponent won (dealt more damage to player than received)
                opponentWonExchange = true;
                battleState.opponentConsecutiveWins++;
                battleState.playerConsecutiveWins = 0;
            } else {
                // Tie - reset both
                battleState.playerConsecutiveWins = 0;
                battleState.opponentConsecutiveWins = 0;
            }
            
            // Check for flash knockout (0.5% chance when winning an exchange)
            if (playerWonExchange && Math.random() < 0.005) {
                battleState.flashKnockout = 'player';
                return;
            }
            if (opponentWonExchange && Math.random() < 0.005) {
                battleState.flashKnockout = 'opponent';
                return;
            }
            
            // Check for consecutive exchange knockout (4 wins in a row)
            if (battleState.playerConsecutiveWins >= 4) {
                battleState.consecutiveKnockout = 'player';
                return;
            }
            if (battleState.opponentConsecutiveWins >= 4) {
                battleState.consecutiveKnockout = 'opponent';
                return;
            }
            
            // Check for rocked status (2 consecutive wins)
            if (battleState.playerConsecutiveWins >= 2 && battleState.opponentRockedRoundsLeft === 0) {
                battleState.opponentRockedRoundsLeft = 2;
                // Don't reset consecutive wins here - let them build to 4 for knockout
            }
            
            if (battleState.opponentConsecutiveWins >= 2 && battleState.playerRockedRoundsLeft === 0) {
                battleState.playerRockedRoundsLeft = 2;
                // Don't reset consecutive wins here - let them build to 4 for knockout
            }
        }

        function applyRockedEffects(playerAttack, opponentAttack, playerDamage, opponentDamage, playerHealthGain, opponentHealthGain) {
            // Apply rocked effects to player
            if (battleState.playerRockedRoundsLeft > 0) {
                // Player does 2 less damage
                if (playerAttack !== 'block') {
                    playerDamage = Math.max(1, playerDamage - 2);
                }
                // Player heals for 1 less health
                if (playerHealthGain > 0) {
                    playerHealthGain = Math.max(0, playerHealthGain - 1);
                }
                // Player takes 2 more damage (applied to opponent's damage to player)
                if (opponentAttack !== 'block') {
                    opponentDamage += 2;
                }
            }
            
            // Apply rocked effects to opponent
            if (battleState.opponentRockedRoundsLeft > 0) {
                // Opponent does 2 less damage
                if (opponentAttack !== 'block') {
                    opponentDamage = Math.max(1, opponentDamage - 2);
                }
                // Opponent heals for 1 less health
                if (opponentHealthGain > 0) {
                    opponentHealthGain = Math.max(0, opponentHealthGain - 1);
                }
                // Opponent takes 2 more damage (applied to player's damage to opponent)
                if (playerAttack !== 'block') {
                    playerDamage += 2;
                }
            }
            
            return {
                playerDamage,
                opponentDamage,
                playerHealthGain,
                opponentHealthGain
            };
        }

        function enableAttackButtons() {
            const buttons = document.querySelectorAll('.attack-btn, .category-btn');
            buttons.forEach(btn => {
                btn.disabled = false;
            });
        }

        function disableAttackButtons() {
            const buttons = document.querySelectorAll('.attack-btn, .category-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
            });
        }

        function showTacticalMenu() {
            document.getElementById('tactical-menu').style.display = 'block';
            document.getElementById('attack-buttons').style.display = 'none';
            document.getElementById('controlled-attack-buttons').style.display = 'none';
            document.getElementById('defense-buttons').style.display = 'none';
            document.getElementById('clinch-buttons').style.display = 'none';
        }

        function showAttackMenu() {
            document.getElementById('tactical-menu').style.display = 'none';
            document.getElementById('defense-buttons').style.display = 'none';
            document.getElementById('clinch-buttons').style.display = 'none';
            
            // Show different attack buttons based on clinch state
            if (battleState.isClinched && !battleState.playerHasControl) {
                // Player is clinched but not in control - show limited clinch options
                document.getElementById('attack-buttons').style.display = 'none';
                document.getElementById('controlled-attack-buttons').style.display = 'grid';
            } else {
                // Normal attack options (including when player controls clinch)
                document.getElementById('attack-buttons').style.display = 'grid';
                document.getElementById('controlled-attack-buttons').style.display = 'none';
            }
        }

        function showDefenseMenu() {
            document.getElementById('tactical-menu').style.display = 'none';
            document.getElementById('attack-buttons').style.display = 'none';
            document.getElementById('controlled-attack-buttons').style.display = 'none';
            document.getElementById('defense-buttons').style.display = 'grid';
            document.getElementById('clinch-buttons').style.display = 'none';
            
            // Show knee shield only if opponent has clinch control
            const kneeShieldBtn = document.getElementById('knee-shield-btn');
            if (battleState.isClinched && !battleState.playerHasControl) {
                kneeShieldBtn.style.display = 'block';
            } else {
                kneeShieldBtn.style.display = 'none';
            }
        }

        function showClinchMenu() {
            document.getElementById('tactical-menu').style.display = 'none';
            document.getElementById('attack-buttons').style.display = 'none';
            document.getElementById('controlled-attack-buttons').style.display = 'none';
            document.getElementById('defense-buttons').style.display = 'none';
            document.getElementById('clinch-buttons').style.display = 'grid';
        }

        function showFighterSelection() {
            document.getElementById('battle-screen').style.display = 'none';
            document.getElementById('fighter-selection').style.display = 'block';
        }

        function resetBattle() {
            if (battleState.isCareerMode) {
                showCareerMain();
            } else if (battleState.playerFighter && battleState.opponentFighter) {
                startBattle();
            } else {
                showFighterSelection();
            }
        }

        function showVictoryPopup(winner, method) {
            // Create victory popup overlay
            setTimeout(() => {
                const existingOverlay = document.getElementById('victory-popup-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }

                const overlay = document.createElement('div');
                overlay.id = 'victory-popup-overlay';
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.9);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    animation: fadeIn 0.5s ease;
                `;

                const popupContainer = document.createElement('div');
                popupContainer.style.cssText = `
                    background: linear-gradient(135deg, #fd79a8, #fdcb6e);
                    color: white;
                    padding: 50px;
                    border-radius: 25px;
                    text-align: center;
                    max-width: 600px;
                    margin: 20px;
                    box-shadow: 0 25px 80px rgba(0,0,0,0.5);
                    border: 4px solid rgba(255,255,255,0.3);
                    transform: scale(0.8);
                    animation: popupScale 0.5s ease forwards;
                `;

                // Determine if player won
                const playerWon = (battleState.isCareerMode && winner === careerState.fighterName) || 
                                 (!battleState.isCareerMode && winner === fighters[battleState.playerFighter]?.name);

                const winnerEmoji = playerWon ? '🏆' : '💀';
                const winnerColor = playerWon ? '#00b894' : '#e17055';

                popupContainer.innerHTML = `
                    <div style="font-size: 4rem; margin-bottom: 20px;">${winnerEmoji}</div>
                    <h2 style="margin-bottom: 15px; font-size: 2.2rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">Winner:</h2>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 15px; margin-bottom: 25px; border: 2px solid rgba(255,255,255,0.3);">
                        <h3 style="font-size: 1.8rem; margin: 0; color: ${winnerColor}; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">${winner}</h3>
                    </div>
                    <h3 style="margin-bottom: 15px; font-size: 1.6rem; opacity: 0.9;">Method of Victory:</h3>
                    <div style="background: rgba(255,255,255,0.2); padding: 12px 20px; border-radius: 12px; margin-bottom: 40px; border: 2px solid rgba(255,255,255,0.3);">
                        <p style="font-size: 1.4rem; margin: 0; font-weight: bold;">${method}</p>
                    </div>
                    <div style="display: grid; gap: 20px; max-width: 400px; margin: 0 auto;">
                        <button onclick="victoryFightAgain()" style="background: linear-gradient(135deg, #00b894, #00cec9); color: white; border: none; padding: 18px 30px; border-radius: 15px; cursor: pointer; font-size: 1.3rem; font-weight: bold; transition: all 0.3s ease; border: 2px solid rgba(255,255,255,0.3);">
                            ⚔️ Fight Again
                        </button>
                        <button onclick="victoryExitToMainMenu()" style="background: linear-gradient(135deg, #636e72, #2d3436); color: white; border: none; padding: 18px 30px; border-radius: 15px; cursor: pointer; font-size: 1.3rem; font-weight: bold; transition: all 0.3s ease; border: 2px solid rgba(255,255,255,0.3);">
                            🏠 Exit to Main Menu
                        </button>
                    </div>
                `;

                overlay.appendChild(popupContainer);
                document.body.appendChild(overlay);

                // Add hover effects
                const buttons = popupContainer.querySelectorAll('button');
                buttons.forEach(button => {
                    button.addEventListener('mouseenter', () => {
                        button.style.transform = 'translateY(-5px) scale(1.05)';
                        button.style.boxShadow = '0 15px 35px rgba(0,0,0,0.4)';
                    });
                    button.addEventListener('mouseleave', () => {
                        button.style.transform = 'translateY(0) scale(1)';
                        button.style.boxShadow = 'none';
                    });
                });
            }, 2000); // Show popup 2 seconds after fight ends
        }

        function showPostFightOptions() {
            // Legacy function - now using victory popup
            showVictoryPopup('Fight Complete', 'Exhibition Match');
        }

        function victoryFightAgain() {
            document.getElementById('victory-popup-overlay')?.remove();
            if (battleState.isCareerMode) {
                showCareerMain();
            } else {
                showFighterSelection();
            }
        }

        function victoryExitToMainMenu() {
            document.getElementById('victory-popup-overlay')?.remove();
            showGameMainMenu();
        }

        function selectNewOpponent() {
            document.getElementById('post-fight-overlay')?.remove();
            showFighterSelection();
        }

        function rematchOpponent() {
            document.getElementById('post-fight-overlay')?.remove();
            startBattle();
        }

        function returnToGameMenu() {
            document.getElementById('post-fight-overlay')?.remove();
            showGameMainMenu();
        }

        // Game Navigation Functions
        function showGameMainMenu() {
            hideAllGameScreens();
            document.getElementById('game-main-menu').style.display = 'block';
        }

        function showExhibitionFight() {
            battleState.isCareerMode = false;
            hideAllGameScreens();
            document.getElementById('round-selection').style.display = 'block';
        }

        function showRoundSelection() {
            hideAllGameScreens();
            document.getElementById('round-selection').style.display = 'block';
        }

        function showFighterSelection() {
            hideAllGameScreens();
            document.getElementById('fighter-selection').style.display = 'block';
        }

        function selectRounds(rounds) {
            battleState.maxRounds = rounds;
            showFighterSelection();
        }

        function showCareerMode() {
            hideAllGameScreens();
            if (careerState.fighterName) {
                showCareerMain();
            } else {
                document.getElementById('career-setup').style.display = 'block';
            }
        }

        function hideAllGameScreens() {
            document.getElementById('game-main-menu').style.display = 'none';
            document.getElementById('round-selection').style.display = 'none';
            document.getElementById('fighter-selection').style.display = 'none';
            document.getElementById('career-setup').style.display = 'none';
            document.getElementById('career-main').style.display = 'none';
            document.getElementById('battle-screen').style.display = 'none';
        }

        // Career Mode Functions
        function selectAvatar(avatar) {
            // Remove previous selection
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to clicked avatar
            document.querySelector(`[data-avatar="${avatar}"]`).classList.add('selected');
            careerState.selectedAvatar = avatar;
            
            checkCreateButtonState();
        }

        function selectSpecialty(specialty) {
            // Remove previous selection
            document.querySelectorAll('.specialty-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to clicked specialty
            document.querySelector(`[data-specialty="${specialty}"]`).classList.add('selected');
            careerState.selectedSpecialty = specialty;
            
            checkCreateButtonState();
        }

        function checkCreateButtonState() {
            const nameInput = document.getElementById('fighter-name');
            const createButton = document.getElementById('create-fighter-btn');
            
            const hasName = nameInput.value.trim().length > 0;
            const hasAvatar = careerState.selectedAvatar !== '';
            const hasSpecialty = careerState.selectedSpecialty !== '';
            
            createButton.disabled = !(hasName && hasAvatar && hasSpecialty);
        }

        function createCareerFighter() {
            const nameInput = document.getElementById('fighter-name');
            
            careerState.fighterName = nameInput.value.trim();
            careerState.fighterAvatar = careerState.selectedAvatar;
            careerState.fighterSpecialty = careerState.selectedSpecialty;
            careerState.wins = 0;
            careerState.losses = 0;
            careerState.draws = 0;
            careerState.defeatedOpponents = [];
            
            // Save to localStorage
            saveCareerData();
            
            showCareerMain();
        }

        function showCareerMain() {
            hideAllGameScreens();
            document.getElementById('career-main').style.display = 'block';
            
            // Update fighter profile display
            document.getElementById('career-avatar').innerHTML = careerState.fighterAvatar;
            document.getElementById('career-fighter-name').textContent = careerState.fighterName;
            document.getElementById('career-record').textContent = `Record: ${careerState.wins}-${careerState.losses}-${careerState.draws}`;
            
            // Get specialty name
            const specialtyNames = {
                dieselnoi: 'Knees',
                buakaw: 'Kicks',
                samart: 'Punches',
                namsaknoi: 'Elbows',
                saenchai: 'All-Around',
                sagat: 'Power',
                somrak: 'Speed',
                yodsanklai: 'Technique',
                johnwayne: 'Heart',
                petchboonchu: 'Clinch'
            };
            document.getElementById('career-specialty').textContent = `Specialty: ${specialtyNames[careerState.fighterSpecialty]}`;
            
            // Populate opponent list
            populateOpponentList();
        }

        function populateOpponentList() {
            const opponentList = document.getElementById('opponent-list');
            opponentList.innerHTML = '';
            
            Object.keys(fighters).forEach((fighterId, index) => {
                const fighter = fighters[fighterId];
                const isDefeated = careerState.defeatedOpponents.includes(fighterId);
                
                // Determine rounds based on opponent index
                let rounds = 3; // Default for first 3 fights
                if (index >= 3 && index < 6) rounds = 5; // Next 3 fights
                else if (index === 6) rounds = 8; // 7th fight
                else if (index === 7) rounds = 10; // 8th fight
                else if (index === 8) rounds = 12; // Final fight
                
                const opponentCard = document.createElement('div');
                opponentCard.className = `opponent-card ${isDefeated ? 'defeated' : ''}`;
                opponentCard.onclick = () => startCareerFight(fighterId, rounds);
                
                opponentCard.innerHTML = `
                    <div class="opponent-avatar">${fighter.avatar}</div>
                    <h4>${fighter.name}</h4>
                    <p>${fighter.nickname}</p>
                    <div class="opponent-stats">${rounds} Rounds - Click to Fight</div>
                `;
                
                opponentList.appendChild(opponentCard);
            });
        }

        function startCareerFight(opponentId, rounds) {
            battleState.isCareerMode = true;
            battleState.playerFighter = 'career'; // Special identifier for career fighter
            battleState.opponentFighter = opponentId;
            battleState.maxRounds = rounds;
            
            startBattle();
        }

        function resetCareer() {
            if (confirm('Are you sure you want to reset your career? This will delete all progress.')) {
                careerState = {
                    fighterName: '',
                    fighterAvatar: '',
                    fighterSpecialty: '',
                    wins: 0,
                    losses: 0,
                    draws: 0,
                    defeatedOpponents: [],
                    selectedAvatar: '',
                    selectedSpecialty: ''
                };
                
                // Clear localStorage
                localStorage.removeItem('muayThaiCareer');
                
                // Reset form
                document.getElementById('fighter-name').value = '';
                document.querySelectorAll('.avatar-option').forEach(option => {
                    option.classList.remove('selected');
                });
                document.querySelectorAll('.specialty-option').forEach(option => {
                    option.classList.remove('selected');
                });
                
                showCareerMode();
            }
        }

        function saveCareerData() {
            localStorage.setItem('muayThaiCareer', JSON.stringify(careerState));
        }

        function loadCareerData() {
            const saved = localStorage.getItem('muayThaiCareer');
            if (saved) {
                careerState = JSON.parse(saved);
            }
        }

        // Modified endBattle function to handle career mode
        function endBattle() {
            battleState.gameActive = false;
            let result = '';
            let playerWon = false;

            if (battleState.playerHealth <= 0) {
                result = '💀 KNOCKOUT! You have been defeated!';
                playerWon = false;
            } else {
                result = '🥊 KNOCKOUT! You are victorious!';
                playerWon = true;
            }

            // Update career record if in career mode
            if (battleState.isCareerMode) {
                updateCareerRecord(playerWon, false); // false = not a draw
            }

            updateActionDisplay(result);
            disableAttackButtons();
        }

        // Modified endFight function to handle career mode
        function endFight() {
            battleState.gameActive = false;
            let winner = '';
            let playerWon = false;
            let isDraw = false;

            if (battleState.playerHealth > battleState.opponentHealth) {
                winner = battleState.isCareerMode ? careerState.fighterName : fighters[battleState.playerFighter].name;
                playerWon = true;
            } else if (battleState.opponentHealth > battleState.playerHealth) {
                winner = fighters[battleState.opponentFighter].name;
                playerWon = false;
            } else {
                winner = 'Draw';
                isDraw = true;
            }

            // Update career record if in career mode
            if (battleState.isCareerMode) {
                updateCareerRecord(playerWon, isDraw);
            }

            showFightResult(winner);
        }

        function updateCareerRecord(playerWon, isDraw) {
            if (!battleState.isCareerMode) return;
            
            if (isDraw) {
                careerState.draws++;
            } else if (playerWon) {
                careerState.wins++;
                // Mark opponent as defeated if not already
                if (!careerState.defeatedOpponents.includes(battleState.opponentFighter)) {
                    careerState.defeatedOpponents.push(battleState.opponentFighter);
                }
            } else {
                careerState.losses++;
            }
            
            saveCareerData();
            
            // Update display immediately if career screen is visible
            if (document.getElementById('career-main').style.display === 'block') {
                document.getElementById('career-record').textContent = `Record: ${careerState.wins}-${careerState.losses}-${careerState.draws}`;
            }
        }

        // Modified selectFighter to handle career mode
        function selectFighter(fighterId) {
            if (battleState.isCareerMode) {
                // This shouldn't happen in career mode, but just in case
                return;
            }
            
            battleState.playerFighter = fighterId;
            
            // Randomly select opponent (different from player)
            const availableOpponents = Object.keys(fighters).filter(id => id !== fighterId);
            battleState.opponentFighter = availableOpponents[Math.floor(Math.random() * availableOpponents.length)];
            
            startBattle();
        }

        // Modified startBattle to handle career mode
        function startBattle() {
            // Reset battle state
            battleState.playerHealth = 100;
            battleState.opponentHealth = 100;
            battleState.currentRound = 1;
            battleState.attacksInCurrentRound = 0;
            battleState.playerTurn = true;
            battleState.playerAction = null;
            battleState.opponentAction = null;
            battleState.gameActive = true;
            battleState.playerHasFirstMove = true;
            // Reset rest period
            battleState.isRestPeriod = false;
            battleState.restTimer = 60;
            battleState.playerCornerChoice = null;
            battleState.opponentCornerChoice = null;
            battleState.waitingForCornerChoices = false;
            // Reset counters
            battleState.attackCount = 0;
            battleState.blockCount = 0;
            battleState.counterCount = 0;
            battleState.opponentAttackCount = 0;
            battleState.opponentBlockCount = 0;
            battleState.opponentCounterCount = 0;
            // Reset total counters
            battleState.totalAttackCount = 0;
            battleState.totalBlockCount = 0;
            battleState.totalCounterCount = 0;
            battleState.totalOpponentAttackCount = 0;
            battleState.totalOpponentBlockCount = 0;
            battleState.totalOpponentCounterCount = 0;
            // Reset round health tracking
            battleState.roundHealthScores = [];
            // Reset consecutive blocking
            battleState.playerConsecutiveBlocks = 0;
            battleState.opponentConsecutiveBlocks = 0;
            // Reset rocked status
            battleState.playerRockedRoundsLeft = 0;
            battleState.opponentRockedRoundsLeft = 0;
            battleState.playerConsecutiveWins = 0;
            battleState.opponentConsecutiveWins = 0;
            // Reset knockout states
            battleState.flashKnockout = null;
            battleState.consecutiveKnockout = null;
            // Reset special effects
            battleState.playerWaterStacks = 0;
            battleState.playerWaterAttacksLeft = 0;
            battleState.playerIceBlocksLeft = 0;
            battleState.playerEnswellPunchesLeft = 0;
            battleState.playerMotivationWinsLeft = 0;
            battleState.playerParryNextAttackBonus = 0;
            battleState.opponentWaterStacks = 0;
            battleState.opponentWaterAttacksLeft = 0;
            battleState.opponentIceBlocksLeft = 0;
            battleState.opponentEnswellPunchesLeft = 0;
            battleState.opponentMotivationWinsLeft = 0;
            battleState.opponentParryNextAttackBonus = 0;
            // Reset attack history
            battleState.playerLastAttack = null;
            battleState.opponentLastAttack = null;
            battleState.playerLastDamage = 0;
            battleState.opponentLastDamage = 0;
            // Reset clinch state
            battleState.isClinched = false;
            battleState.playerHasControl = false;
            // Reset moral system
            battleState.playerMoral = 0;
            battleState.opponentMoral = 0;
            battleState.playerKnockedDown = false;
            battleState.opponentKnockedDown = false;

            // Hide all game screens, show battle screen
            hideAllGameScreens();
            document.getElementById('battle-screen').style.display = 'block';
            document.getElementById('corner-break').style.display = 'none';

            // Update fighter displays
            let playerFighter, opponentFighter;
            
            if (battleState.isCareerMode) {
                playerFighter = {
                    name: careerState.fighterName,
                    avatar: careerState.fighterAvatar
                };
            } else {
                playerFighter = fighters[battleState.playerFighter];
            }
            
            opponentFighter = fighters[battleState.opponentFighter];

            document.getElementById('player-fighter-name').textContent = playerFighter.name;
            document.getElementById('player-avatar').innerHTML = playerFighter.avatar;
            document.getElementById('opponent-fighter-name').textContent = opponentFighter.name;
            document.getElementById('opponent-avatar').innerHTML = opponentFighter.avatar;

            updateHealthBars();
            updateRoundDisplay();
            updateCounterDisplay();
            updateAttackHistory();
            updateClinchDisplay();
            updateActionDisplay('Choose your attack!');
            showTacticalMenu();
            enableAttackButtons();
        }

        // Modified applyFighterSpecialties to handle career mode
        function applyFighterSpecialties(playerAttack, opponentAttack, playerDamage, opponentDamage, playerHealthGain, opponentHealthGain, playerGainedBonus, opponentGainedBonus) {
            const playerFighter = battleState.isCareerMode ? careerState.fighterSpecialty : battleState.playerFighter;
            const opponentFighter = battleState.opponentFighter;

            // Apply special effects first
            // Water effects - bonus damage to attacks
            if (playerAttack !== 'block' && !isDefenseTechnique(playerAttack) && battleState.playerWaterAttacksLeft > 0) {
                playerDamage += battleState.playerWaterStacks;
                battleState.playerWaterAttacksLeft--;
            }
            if (opponentAttack !== 'block' && !isDefenseTechnique(opponentAttack) && battleState.opponentWaterAttacksLeft > 0) {
                opponentDamage += battleState.opponentWaterStacks;
                battleState.opponentWaterAttacksLeft--;
            }

            // Apply slip/roll bonuses to next attack
            if (!isDefenseTechnique(playerAttack) && playerAttack !== 'block' && battleState.playerSlipNextAttackBonus > 0) {
                playerDamage += battleState.playerSlipNextAttackBonus;
                battleState.playerSlipNextAttackBonus = 0;
            }
            if (!isDefenseTechnique(playerAttack) && playerAttack !== 'block' && battleState.playerRollNextAttackBonus > 0) {
                playerDamage += battleState.playerRollNextAttackBonus;
                battleState.playerRollNextAttackBonus = 0;
            }
            if (!isDefenseTechnique(opponentAttack) && opponentAttack !== 'block' && battleState.opponentSlipNextAttackBonus > 0) {
                opponentDamage += battleState.opponentSlipNextAttackBonus;
                battleState.opponentSlipNextAttackBonus = 0;
            }
            if (!isDefenseTechnique(opponentAttack) && opponentAttack !== 'block' && battleState.opponentRollNextAttackBonus > 0) {
                opponentDamage += battleState.opponentRollNextAttackBonus;
                battleState.opponentRollNextAttackBonus = 0;
            }

            // Apply parry bonuses to next punch or kick
            if ((playerAttack === 'punch' || playerAttack === 'kick') && battleState.playerParryNextAttackBonus > 0) {
                playerDamage += battleState.playerParryNextAttackBonus;
                battleState.playerParryNextAttackBonus = 0;
            }
            if ((opponentAttack === 'punch' || opponentAttack === 'kick') && battleState.opponentParryNextAttackBonus > 0) {
                opponentDamage += battleState.opponentParryNextAttackBonus;
                battleState.opponentParryNextAttackBonus = 0;
            }

            // Apply slip/roll reductions to punches and elbows
            if (playerAttack === 'punch' && battleState.playerSlipPunchReduction > 0) {
                playerDamage = Math.max(1, playerDamage - battleState.playerSlipPunchReduction);
            }
            if (playerAttack === 'elbow' && battleState.playerSlipElbowReduction > 0) {
                playerDamage = Math.max(1, playerDamage - battleState.playerSlipElbowReduction);
            }
            if (playerAttack === 'punch' && battleState.playerRollPunchReduction > 0) {
                playerDamage = Math.max(1, playerDamage - battleState.playerRollPunchReduction);
            }
            if (playerAttack === 'elbow' && battleState.playerRollElbowReduction > 0) {
                playerDamage = Math.max(1, playerDamage - battleState.playerRollElbowReduction);
            }
            
            if (opponentAttack === 'punch' && battleState.opponentSlipPunchReduction > 0) {
                opponentDamage = Math.max(1, opponentDamage - battleState.opponentSlipPunchReduction);
            }
            if (opponentAttack === 'elbow' && battleState.opponentSlipElbowReduction > 0) {
                opponentDamage = Math.max(1, opponentDamage - battleState.opponentSlipElbowReduction);
            }
            if (opponentAttack === 'punch' && battleState.opponentRollPunchReduction > 0) {
                opponentDamage = Math.max(1, opponentDamage - battleState.opponentRollPunchReduction);
            }
            if (opponentAttack === 'elbow' && battleState.opponentRollElbowReduction > 0) {
                opponentDamage = Math.max(1, opponentDamage - battleState.opponentRollElbowReduction);
            }

            // Ice effects - bonus to blocks
            if (playerAttack === 'block' && battleState.playerIceBlocksLeft > 0) {
                playerHealthGain += 3;
                battleState.playerIceBlocksLeft--;
            }
            if (opponentAttack === 'block' && battleState.opponentIceBlocksLeft > 0) {
                opponentHealthGain += 3;
                battleState.opponentIceBlocksLeft--;
            }

            // Enswell effects - reduce opponent punch damage
            if (playerAttack === 'punch' && battleState.opponentEnswellPunchesLeft > 0) {
                playerDamage = Math.max(1, playerDamage - 3);
                battleState.opponentEnswellPunchesLeft--;
            }
            if (opponentAttack === 'punch' && battleState.playerEnswellPunchesLeft > 0) {
                opponentDamage = Math.max(1, opponentDamage - 3);
                battleState.playerEnswellPunchesLeft--;
            }

            // Motivation effects - bonus to winning exchanges
            if (playerGainedBonus && battleState.playerMotivationWinsLeft > 0) {
                playerDamage += 10;
                battleState.playerMotivationWinsLeft--;
            }
            if (opponentGainedBonus && battleState.opponentMotivationWinsLeft > 0) {
                opponentDamage += 10;
                battleState.opponentMotivationWinsLeft--;
            }

            // Apply player specialty bonuses
            if (playerAttack !== 'block' && opponentAttack !== 'block') {
                // Dieselnoi - Knees specialty
                if (playerFighter === 'dieselnoi' && playerAttack === 'knee') {
                    playerDamage += 3;
                }
                // Buakaw - Kicks specialty  
                if (playerFighter === 'buakaw' && (playerAttack === 'kick' || playerAttack === 'teep')) {
                    playerDamage += 3;
                }
                // Samart - Punches specialty
                if (playerFighter === 'samart' && playerAttack === 'punch') {
                    playerDamage += 3;
                }
                // Namsaknoi - Elbows specialty
                if (playerFighter === 'namsaknoi' && playerAttack === 'elbow') {
                    playerDamage += 3;
                }
                // Saenchai - All-Around specialty
                if (playerFighter === 'saenchai') {
                    playerDamage += 1;
                }
                // Sagat - Power specialty (gains +10 when move would gain bonus)
                if (playerFighter === 'sagat' && playerGainedBonus) {
                    playerDamage += 10;
                }
                // Yodsanklai - Technique specialty (gains +8 when move would gain bonus, -2 when losing)
                if (playerFighter === 'yodsanklai') {
                    if (playerGainedBonus) {
                        playerDamage += 8;
                    } else if (checkOpponentWinsExchange(playerAttack, opponentAttack)) {
                        playerDamage = Math.max(1, playerDamage - 2);
                    }
                }
            }

            // Apply opponent specialty bonuses
            if (opponentAttack !== 'block' && playerAttack !== 'block') {
                // Dieselnoi - Knees specialty
                if (opponentFighter === 'dieselnoi' && opponentAttack === 'knee') {
                    opponentDamage += 3;
                }
                // Buakaw - Kicks specialty
                if (opponentFighter === 'buakaw' && (opponentAttack === 'kick' || opponentAttack === 'teep')) {
                    opponentDamage += 3;
                }
                // Samart - Punches specialty
                if (opponentFighter === 'samart' && opponentAttack === 'punch') {
                    opponentDamage += 3;
                }
                // Namsaknoi - Elbows specialty
                if (opponentFighter === 'namsaknoi' && opponentAttack === 'elbow') {
                    opponentDamage += 3;
                }
                // Saenchai - All-Around specialty
                if (opponentFighter === 'saenchai') {
                    opponentDamage += 1;
                }
                // Sagat - Power specialty (gains +10 when move would gain bonus)
                if (opponentFighter === 'sagat' && opponentGainedBonus) {
                    opponentDamage += 10;
                }
                // Yodsanklai - Technique specialty (gains +8 when move would gain bonus, -2 when losing)
                if (opponentFighter === 'yodsanklai') {
                    if (opponentGainedBonus) {
                        opponentDamage += 8;
                    } else if (checkPlayerWinsExchange(playerAttack, opponentAttack)) {
                        opponentDamage = Math.max(1, opponentDamage - 2);
                    }
                }
            }

            // Apply healing bonuses
            if (playerAttack === 'block' || (playerAttack === 'block' && opponentAttack === 'block')) {
                // Saenchai - All-Around specialty (+1 to heals)
                if (playerFighter === 'saenchai') {
                    playerHealthGain += 1;
                }
                // John Wayne Parr - Heart specialty (+10 to heals, +25 if both heal)
                if (playerFighter === 'johnwayne') {
                    if (playerAttack === 'block' && opponentAttack === 'block') {
                        playerHealthGain += 25; // +25 if both heal
                    } else {
                        playerHealthGain += 10; // +10 for regular heals
                    }
                }
                // Petchboonchu - Clinch specialty (+5 to all clinch attacks)
                if (playerFighter === 'petchboonchu' && isClinchTechnique(playerAttack)) {
                    playerDamage += 5;
                }
                if (playerFighter === 'petchboonchu' && (playerAttack === 'round-knee' || playerAttack === 'angled-knee' || playerAttack === 'knee-shield')) {
                    playerDamage += 5;
                }
            }

            if (opponentAttack === 'block' || (playerAttack === 'block' && opponentAttack === 'block')) {
                // Saenchai - All-Around specialty (+1 to heals)
                if (opponentFighter === 'saenchai') {
                    opponentHealthGain += 1;
                }
                // John Wayne Parr - Heart specialty (+10 to heals, +25 if both heal)
                if (opponentFighter === 'johnwayne') {
                    if (playerAttack === 'block' && opponentAttack === 'block') {
                        opponentHealthGain += 25; // +25 if both heal
                    } else {
                        opponentHealthGain += 10; // +10 for regular heals
                    }
                }
                // Petchboonchu - Clinch specialty (+5 to all clinch attacks)
                if (opponentFighter === 'petchboonchu' && isClinchTechnique(opponentAttack)) {
                    opponentDamage += 5;
                }
                if (opponentFighter === 'petchboonchu' && (opponentAttack === 'round-knee' || opponentAttack === 'angled-knee' || opponentAttack === 'knee-shield')) {
                    opponentDamage += 5;
                }
            }

            // Somrak - Speed specialty (all opponent attacks lose -2 power)
            if (playerFighter === 'somrak' && opponentAttack !== 'block') {
                opponentDamage = Math.max(1, opponentDamage - 2);
            }
            if (opponentFighter === 'somrak' && playerAttack !== 'block') {
                playerDamage = Math.max(1, playerDamage - 2);
            }

            return {
                playerDamage,
                opponentDamage,
                playerHealthGain,
                opponentHealthGain
            };
        }

        // Populate avatar selection for career mode
        function populateAvatarSelection() {
            const avatarSelection = document.getElementById('avatar-selection');
            if (!avatarSelection) return;
            
            avatarSelection.innerHTML = '';
            
            Object.keys(fighters).forEach(fighterId => {
                const fighter = fighters[fighterId];
                const avatarOption = document.createElement('div');
                avatarOption.className = 'avatar-option';
                avatarOption.setAttribute('data-avatar', fighter.avatar);
                avatarOption.onclick = () => selectAvatar(fighter.avatar);
                avatarOption.innerHTML = fighter.avatar;
                
                avatarSelection.appendChild(avatarOption);
            });
        }

        // Populate fighter selection grid
        function populateFighterGrid() {
            const fighterGrid = document.querySelector('.fighter-grid');
            if (!fighterGrid) return;
            
            fighterGrid.innerHTML = '';
            
            Object.keys(fighters).forEach(fighterId => {
                const fighter = fighters[fighterId];
                const fighterCard = document.createElement('div');
                fighterCard.className = 'fighter-card';
                fighterCard.onclick = () => selectFighter(fighterId);
                
                const specialtyNames = {
                    dieselnoi: 'Knees',
                    buakaw: 'Kicks',
                    samart: 'Punches',
                    namsaknoi: 'Elbows',
                    saenchai: 'All-Around',
                    sagat: 'Power',
                    somrak: 'Speed',
                    yodsanklai: 'Technique',
                    johnwayne: 'Heart',
                    petchboonchu: 'Clinch'
                };
                
                fighterCard.innerHTML = `
                    <div class="fighter-avatar">${fighter.avatar}</div>
                    <h4>${fighter.name}</h4>
                    <p>${fighter.nickname}</p>
                    <div class="fighter-stats">Specialty: ${specialtyNames[fighterId]}</div>
                `;
                
                fighterGrid.appendChild(fighterCard);
            });
        }

        // Add event listener for name input
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('fighter-name');
            if (nameInput) {
                nameInput.addEventListener('input', checkCreateButtonState);
            }
            
            // Load career data on page load
            loadCareerData();
            
            // Populate fighter grid and avatar selection
            populateFighterGrid();
            populateAvatarSelection();
        });

        // Rules toggle functionality
        function toggleRules() {
            const rulesContent = document.getElementById('rules-content');
            const rulesToggle = document.getElementById('rules-toggle');
            
            if (rulesContent.classList.contains('collapsed')) {
                // Expand rules
                rulesContent.classList.remove('collapsed');
                rulesToggle.classList.remove('collapsed');
                rulesToggle.textContent = '▼';
            } else {
                // Collapse rules
                rulesContent.classList.add('collapsed');
                rulesToggle.classList.add('collapsed');
                rulesToggle.textContent = '▶';
            }
        }

        // Rules subsection toggle functionality
        function toggleRulesSubsection(subsectionId) {
            const subsectionContent = document.getElementById(subsectionId);
            const toggleElement = document.getElementById(subsectionId.replace('-rules', '-toggle'));
            
            if (subsectionContent.classList.contains('collapsed')) {
                // Expand subsection
                subsectionContent.classList.remove('collapsed');
                toggleElement.classList.remove('collapsed');
                toggleElement.textContent = '▼';
            } else {
                // Collapse subsection
                subsectionContent.classList.add('collapsed');
                toggleElement.classList.add('collapsed');
                toggleElement.textContent = '▶';
            }
        }

        // Rules popup functionality
        function showRulesPopup() {
            const rulesPopup = document.getElementById('rules-popup');
            rulesPopup.style.display = 'flex';
            
            // Close popup when clicking outside
            rulesPopup.addEventListener('click', function(e) {
                if (e.target === rulesPopup) {
                    closeRulesPopup();
                }
            });
        }

        function closeRulesPopup() {
            const rulesPopup = document.getElementById('rules-popup');
            rulesPopup.style.display = 'none';
        }

        // Initialize rules as collapsed on page load
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('fighter-name');
            if (nameInput) {
                nameInput.addEventListener('input', checkCreateButtonState);
            }
            
            // Load career data on page load
            loadCareerData();
            
            // Populate fighter grid and avatar selection
            populateFighterGrid();
            populateAvatarSelection();
            
            // Initialize rules as collapsed
            const rulesContent = document.getElementById('rules-content');
            const rulesToggle = document.getElementById('rules-toggle');
            if (rulesContent && rulesToggle) {
                rulesContent.classList.add('collapsed');
                rulesToggle.classList.add('collapsed');
                rulesToggle.textContent = '▶';
            }

            // Initialize rule subsections as collapsed
            const subsections = ['offense', 'defense', 'clinch', 'ways-to-win', 'moral-system', 'counters', 'popup-offense', 'popup-defense', 'popup-clinch', 'popup-ways-to-win', 'popup-moral-system', 'popup-counters'];
            subsections.forEach(section => {
                const content = document.getElementById(section + '-rules');
                const toggle = document.getElementById(section + '-toggle');
                if (content && toggle) {
                    content.classList.add('collapsed');
                    toggle.classList.add('collapsed');
                    toggle.textContent = '▶';
                }
            });
        });

        // Add CSS animation for modal
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            
            @keyframes popupScale {
                from { 
                    transform: scale(0.8);
                    opacity: 0;
                }
                to { 
                    transform: scale(1);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96fa811853abe759',t:'MTc1NTI3OTkxMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
